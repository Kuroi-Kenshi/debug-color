"use strict";
/**
 * Created by user on 2018/7/2/002.
 */
Object.defineProperty(exports, "__esModule", { value: true });
/// <reference types="node" />
const chalk_1 = require("chalk");
const luxon_1 = require("luxon");
const util = require("util");
const chk_1 = require("./chk");
const FillProperty = require("./fill-property");
const styles_1 = require("./styles");
const val_1 = require("./val");
const util_1 = require("./util");
class Console2 {
    constructor(target = console, options) {
        this[val_1.SYM_CONSOLE] = target || console;
        if (options && options.chalkOptions) {
            this[val_1.SYM_CHALK] = chalk_1.default.constructor(options.chalkOptions);
        }
        else {
            this[val_1.SYM_CHALK] = chalk_1.default.constructor();
        }
        // @ts-ignore
        this[val_1.SYM_DATA] = Object.create({
            colors: Object.create(val_1.defaultColors),
        });
        // @ts-ignore
        this[val_1.SYM_DATA].stream = null;
        if (this[val_1.SYM_CONSOLE] instanceof Console2) {
            let target = this[val_1.SYM_CONSOLE].getStream();
            if (target) {
                // @ts-ignore
                this[val_1.SYM_DATA].stream = util_1.hasConsoleStream(target);
            }
            else {
                // @ts-ignore
                this[val_1.SYM_DATA].stream = false;
            }
        }
        else {
            // @ts-ignore
            this[val_1.SYM_DATA].stream = util_1.hasConsoleStream(this[val_1.SYM_CONSOLE]);
        }
        Object.assign(this[val_1.SYM_DATA], options || {});
        this[val_1.SYM_DATA].chalkOptions = this[val_1.SYM_DATA].chalkOptions || {};
        if (this[val_1.SYM_DATA].chalkOptions.enabled) {
            this[val_1.SYM_CHALK].enabled = true;
        }
        else if (this[val_1.SYM_CHALK].enabled && !chk_1.default()) {
            this[val_1.SYM_CHALK].enabled = false;
        }
        else if (!this[val_1.SYM_CHALK].enabled && util_1.isForceColor()) {
            this[val_1.SYM_CHALK].enabled = true;
        }
        if (this[val_1.SYM_DATA].inspectOptions && this[val_1.SYM_DATA].inspectOptions.depth < 0) {
            this[val_1.SYM_DATA].inspectOptions.depth = null;
        }
    }
    get _stdout() {
        return this.getStream()._stdout;
    }
    get _stderr() {
        return this.getStream()._stderr;
    }
    getStream() {
        if (this[val_1.SYM_DATA].stream) {
            let _stdout;
            let _stderr;
            if (this[val_1.SYM_CONSOLE] instanceof Console2) {
                return this[val_1.SYM_CONSOLE].getStream();
            }
            else {
                // @ts-ignore
                ({ _stdout, _stderr } = this[val_1.SYM_CONSOLE]);
            }
            return {
                _stdout,
                _stderr,
            };
        }
        return null;
    }
    get chalk() {
        return this[val_1.SYM_CHALK];
    }
    set chalk(value) {
        this[val_1.SYM_CHALK] = value;
    }
    get levelColor() {
        return this[val_1.SYM_CHALK].level;
    }
    set levelColor(value) {
        this[val_1.SYM_CHALK].level = value;
    }
    get enabledColor() {
        return this[val_1.SYM_CHALK].enabled;
    }
    set enabledColor(value) {
        this[val_1.SYM_CHALK].enabled = value;
    }
    get chalkOptions() {
        return this[val_1.SYM_DATA].chalkOptions;
    }
    set chalkOptions(value) {
        this[val_1.SYM_DATA].chalkOptions = value;
    }
    get inspectOptions() {
        return this[val_1.SYM_DATA].inspectOptions;
    }
    set inspectOptions(value) {
        this[val_1.SYM_DATA].inspectOptions = value;
    }
    setInspectOptions(value) {
        this[val_1.SYM_DATA].inspectOptions = Object.assign(this[val_1.SYM_DATA].inspectOptions || {}, value);
    }
    get enabled() {
        return this[val_1.SYM_DATA].enabled !== false;
    }
    set enabled(value) {
        this[val_1.SYM_DATA].enabled = value === true;
    }
    setOptions(options) {
        Object.assign(this[val_1.SYM_DATA], options);
        return this;
    }
    withOptions(options) {
        let o = this._clone();
        o[val_1.SYM_CHALK] = this[val_1.SYM_CHALK];
        o[val_1.SYM_DATA] = Object.assign({}, this[val_1.SYM_DATA], options);
        return o;
    }
    _clone() {
        const self = this;
        let o = function Console2Method(...argv) {
            // @ts-ignore
            return o.log(...argv);
        };
        /**
         * allow hacking parent object
         */
        // @ts-ignore
        //o.__proto__ = this.__proto__.constructor.prototype;
        o.__proto__ = this;
        //o = o.bind(o);
        o[val_1.SYM_CONSOLE] = self[val_1.SYM_CONSOLE];
        o[val_1.SYM_DATA] = self[val_1.SYM_DATA];
        // @ts-ignore
        return o;
    }
    _chalkStyleProp(name) {
        let o = this._clone();
        o[val_1.SYM_CHALK] = this[val_1.SYM_CHALK][name];
        return o;
    }
    _logFormat(format, ...args) {
        return util.format(format, ...args);
    }
    success(...argv) {
        return this._log('success', argv);
    }
    ok(...argv) {
        return this._log('ok', argv);
    }
    fail(...argv) {
        return this._log('fail', argv, 'error');
    }
    _labelFormat(data) {
        if (this[val_1.SYM_DATA].labelFormatFn) {
            return this[val_1.SYM_DATA].labelFormatFn(data);
        }
        return `[${data.name.toString().toUpperCase()}]`;
    }
    _log(name, argv, failBack = 'log') {
        if (!this.enabled) {
            return;
        }
        // @ts-ignore
        let s = this._logFormat(...argv);
        let o = this[val_1.SYM_CHALK](s);
        let arr = [];
        let data = this[val_1.SYM_DATA];
        if (data.time) {
            let ret = this._time({
                name,
                argv,
                failBack,
            });
            if (ret != null) {
                arr.push(ret);
            }
        }
        if (data.label) {
            let _ok = true;
            if (Array.isArray(data.label) && !data.label.includes(name)) {
                _ok = false;
            }
            if (_ok) {
                let ret = this._labelFormat({
                    name,
                    argv,
                    failBack,
                });
                if (ret != null) {
                    arr.push(ret);
                }
            }
        }
        arr.push(o);
        if (arr.length && data.colors && data.colors[name]) {
            let c = data.colors[name];
            if (typeof c === 'string') {
                c = chalk_1.default[c];
            }
            arr = arr.map(v => c(v));
        }
        if (process.platform == 'win32' && this.enabledColor) {
            /**
             * @FIXME fix bug on windows when after bold
             *
             * https://github.com/chalk/chalk/issues/145#issuecomment-288985903
             */
            arr = arr.map(v => '\u001B[0m' + v + '\u001B[0m');
        }
        if (!(name in this[val_1.SYM_CONSOLE])) {
            name = failBack;
        }
        return this[val_1.SYM_CONSOLE][name](...arr);
    }
    _chalkStyleMethod(name) {
        return function chalkStyleMethod(...argv) {
            let o = this._clone();
            o[val_1.SYM_CHALK] = this[val_1.SYM_CHALK][name](...argv);
            return o;
        };
    }
    _time(data) {
        if (this[val_1.SYM_DATA].timeFormatFn) {
            let data2 = {
                ...data,
                failBackTimeFormat: this[val_1.SYM_DATA].timeFormat || '[HH:mm:ss.SSS]',
                date: luxon_1.DateTime.local(),
            };
            return this[val_1.SYM_DATA].timeFormatFn(data2);
        }
        return luxon_1.DateTime.local().toFormat(this[val_1.SYM_DATA].timeFormat || '[HH:mm:ss.SSS]');
    }
}
exports.Console2 = Console2;
util.inherits(Console2, Function);
// @ts-ignore
Console2.prototype.Console = Console2;
styles_1.styleNames.forEach(function (name) {
    if (styles_1.styleNamesFn.includes(name)) {
        Object.defineProperty(Console2.prototype, name, {
            get() {
                return this._chalkStyleMethod(name);
            },
        });
    }
    else {
        Object.defineProperty(Console2.prototype, name, {
            get() {
                return this._chalkStyleProp(name);
            },
        });
    }
});
FillProperty.methods.forEach(function (name) {
    if (name == 'dir') {
        Console2.prototype[name] = function chalkStyleLogOthers(object, options) {
            if (!this.enabled) {
                return;
            }
            let enabledColor = this.enabledColor;
            if (!options && this[val_1.SYM_DATA].inspectOptions) {
                options = this[val_1.SYM_DATA].inspectOptions;
            }
            if (options) {
                if (enabledColor && options.colors == null) {
                    options = {
                        ...options,
                        colors: enabledColor
                    };
                }
                return this[val_1.SYM_CONSOLE][name](object, options);
            }
            return this[val_1.SYM_CONSOLE][name](object, {
                colors: enabledColor,
            });
        };
    }
    else if (name == 'assert') {
        Console2.prototype[name] = function chalkStyleLogAssert(value, ...argv) {
            if (!this.enabled) {
                return;
            }
            if (!value) {
                let o;
                if (argv.length) {
                    let s = this._logFormat(...argv);
                    o = this[val_1.SYM_CHALK](s);
                }
                return this[val_1.SYM_CONSOLE][name](value, o);
            }
        };
    }
    else if (FillProperty.methods_stdout.includes(name)) {
        Console2.prototype[name] = function chalkStyleLog(...argv) {
            return this._log(name, argv);
        };
    }
    else if (FillProperty.methods_stderr.includes(name)) {
        Console2.prototype[name] = function chalkStyleLog(...argv) {
            return this._log(name, argv, 'error');
        };
    }
    else {
        Console2.prototype[name] = function chalkStyleLogOthers(...argv) {
            if (!this.enabled) {
                return;
            }
            return this[val_1.SYM_CONSOLE][name](...argv);
        };
    }
});
exports.default = Console2;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9kZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm5vZGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOztBQUVILDhCQUE4QjtBQUU5QixpQ0FBMEQ7QUFFMUQsaUNBQWlDO0FBQ2pDLDZCQUE4QjtBQUM5QiwrQkFBNkI7QUFDN0IsZ0RBQWlEO0FBQ2pELHFDQUE2RDtBQUM3RCwrQkFBa0Y7QUFDbEYsaUNBQXdEO0FBb0h4RCxNQUFhLFFBQVE7SUFFcEIsWUFBWSxTQUFpRCxPQUFPLEVBQUUsT0FBa0I7UUFFdkYsSUFBSSxDQUFDLGlCQUFXLENBQUMsR0FBRyxNQUFNLElBQUksT0FBTyxDQUFDO1FBRXRDLElBQUksT0FBTyxJQUFJLE9BQU8sQ0FBQyxZQUFZLEVBQ25DO1lBQ0MsSUFBSSxDQUFDLGVBQVMsQ0FBQyxHQUFHLGVBQUssQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQzFEO2FBRUQ7WUFDQyxJQUFJLENBQUMsZUFBUyxDQUFDLEdBQUcsZUFBSyxDQUFDLFdBQVcsRUFBRSxDQUFDO1NBQ3RDO1FBRUQsYUFBYTtRQUNiLElBQUksQ0FBQyxjQUFRLENBQUMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDO1lBQzlCLE1BQU0sRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLG1CQUFhLENBQUM7U0FFcEMsQ0FBQyxDQUFDO1FBRUgsYUFBYTtRQUNiLElBQUksQ0FBQyxjQUFRLENBQUMsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1FBRTdCLElBQUksSUFBSSxDQUFDLGlCQUFXLENBQUMsWUFBWSxRQUFRLEVBQ3pDO1lBQ0MsSUFBSSxNQUFNLEdBQUksSUFBSSxDQUFDLGlCQUFXLENBQWMsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUV6RCxJQUFJLE1BQU0sRUFDVjtnQkFDQyxhQUFhO2dCQUNiLElBQUksQ0FBQyxjQUFRLENBQUMsQ0FBQyxNQUFNLEdBQUcsdUJBQWdCLENBQUMsTUFBTSxDQUFDLENB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R0FBRyxJQUFJO1lBRS9ELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUE7UUFDN0IsQ0FBQyxDQUFDO0tBQ0Y7U0FDSSxJQUFJLFlBQVksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLElBQVcsQ0FBQyxFQUMxRDtRQUNDLFFBQVEsQ0FBQyxTQUFTLENBQUMsSUFBVyxDQUFDLEdBQUcsU0FBUyxhQUFhLENBQUMsR0FBRyxJQUFJO1lBRS9ELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFBO1FBQ3RDLENBQUMsQ0FBQztLQUNGO1NBRUQ7UUFDQyxRQUFRLENBQUMsU0FBUyxDQUFDLElBQVcsQ0FBQyxHQUFHLFNBQVMsbUJBQW1CLENBQUMsR0FBRyxJQUFJO1lBRXJFLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUNqQjtnQkFDQyxPQUFPO2FBQ1A7WUFFRCxPQUFPLElBQUksQ0FBQyxpQkFBVyxDQUFDLENBQUMsSUFBVyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQztRQUNoRCxDQUFDLENBQUM7S0FDRjtBQUNGLENBQUMsQ0FBQyxDQUFDO0FBRUgsa0JBQWUsUUFBUSxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IHVzZXIgb24gMjAxOC83LzIvMDAyLlxuICovXG5cbi8vLyA8cmVmZXJlbmNlIHR5cGVzPVwibm9kZVwiIC8+XG5cbmltcG9ydCBjaGFsaywgeyBDaGFsaywgTGV2ZWwsIENoYWxrT3B0aW9ucyB9IGZyb20gJ2NoYWxrJztcbmltcG9ydCB7IENvbnNvbGUgfSBmcm9tICdjb25zb2xlJztcbmltcG9ydCB7IERhdGVUaW1lIH0gZnJvbSAnbHV4b24nO1xuaW1wb3J0IHV0aWwgPSByZXF1aXJlKCd1dGlsJyk7XG5pbXBvcnQgaXNOb2RlSnMgZnJvbSAnLi9jaGsnO1xuaW1wb3J0IEZpbGxQcm9wZXJ0eSA9IHJlcXVpcmUoJy4vZmlsbC1wcm9wZXJ0eScpO1xuaW1wb3J0IHsgSVN0eWxlcywgc3R5bGVOYW1lcywgc3R5bGVOYW1lc0ZuIH0gZnJvbSAnLi9zdHlsZXMnO1xuaW1wb3J0IHsgZGVmYXVsdENvbG9ycywgSU9wdGlvbnMsIFNZTV9DSEFMSywgU1lNX0NPTlNPTEUsIFNZTV9EQVRBIH0gZnJvbSAnLi92YWwnO1xuaW1wb3J0IHsgaGFzQ29uc29sZVN0cmVhbSwgaXNGb3JjZUNvbG9yIH0gZnJvbSAnLi91dGlsJztcbmltcG9ydCBXcml0ZVN0cmVhbSA9IE5vZGVKUy5Xcml0ZVN0cmVhbTtcblxuZXhwb3J0IHR5cGUgSUNvbnNvbGVXaXRoU3RyZWFtPFQgZXh0ZW5kcyBvYmplY3QgPSBDb25zb2xlPiA9IFQgJiB7XG5cdF9zdGRvdXQ/OiBXcml0ZVN0cmVhbTtcblx0X3N0ZGVycj86IFdyaXRlU3RyZWFtO1xufVxuXG5leHBvcnQgeyBJbnNwZWN0T3B0aW9ucyB9IGZyb20gJ3V0aWwnO1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbnNvbGUyIGV4dGVuZHMgSUNvbnNvbGVXaXRoU3RyZWFtPENvbnNvbGU+LCBJU3R5bGVzXG57XG5cdCguLi5hcmd2KTogdm9pZFxuXG5cdFtTWU1fQ09OU09MRV06IElDb25zb2xlV2l0aFN0cmVhbTxDb25zb2xlPiB8IENvbnNvbGUyO1xuXHRbU1lNX0NIQUxLXTogQ2hhbGs7XG5cblx0W1NZTV9EQVRBXTogSU9wdGlvbnNcblxuXHQvKipcblx0ICogQSBzaW1wbGUgYXNzZXJ0aW9uIHRlc3QgdGhhdCB2ZXJpZmllcyB3aGV0aGVyIGB2YWx1ZWAgaXMgdHJ1dGh5LlxuXHQgKiBJZiBpdCBpcyBub3QsIGFuIGBBc3NlcnRpb25FcnJvcmAgaXMgdGhyb3duLlxuXHQgKiBJZiBwcm92aWRlZCwgdGhlIGVycm9yIGBtZXNzYWdlYCBpcyBmb3JtYXR0ZWQgdXNpbmcgYHV0aWwuZm9ybWF0KClgIGFuZCB1c2VkIGFzIHRoZSBlcnJvciBtZXNzYWdlLlxuXHQgKi9cblx0YXNzZXJ0KHZhbHVlOiBhbnksIG1lc3NhZ2U/OiBzdHJpbmcsIC4uLm9wdGlvbmFsUGFyYW1zOiBhbnlbXSk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBXaGVuIGBzdGRvdXRgIGlzIGEgVFRZLCBjYWxsaW5nIGBjb25zb2xlLmNsZWFyKClgIHdpbGwgYXR0ZW1wdCB0byBjbGVhciB0aGUgVFRZLlxuXHQgKiBXaGVuIGBzdGRvdXRgIGlzIG5vdCBhIFRUWSwgdGhpcyBtZXRob2QgZG9lcyBub3RoaW5nLlxuXHQgKi9cblx0Y2xlYXIoKTogdm9pZDtcblx0LyoqXG5cdCAqIE1haW50YWlucyBhbiBpbnRlcm5hbCBjb3VudGVyIHNwZWNpZmljIHRvIGBsYWJlbGAgYW5kIG91dHB1dHMgdG8gYHN0ZG91dGAgdGhlIG51bWJlciBvZiB0aW1lcyBgY29uc29sZS5jb3VudCgpYCBoYXMgYmVlbiBjYWxsZWQgd2l0aCB0aGUgZ2l2ZW4gYGxhYmVsYC5cblx0ICovXG5cdGNvdW50KGxhYmVsPzogc3RyaW5nKTogdm9pZDtcblx0LyoqXG5cdCAqIFJlc2V0cyB0aGUgaW50ZXJuYWwgY291bnRlciBzcGVjaWZpYyB0byBgbGFiZWxgLlxuXHQgKi9cblx0Y291bnRSZXNldChsYWJlbD86IHN0cmluZyk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBUaGUgYGNvbnNvbGUuZGVidWcoKWAgZnVuY3Rpb24gaXMgYW4gYWxpYXMgZm9yIHtAbGluayBjb25zb2xlLmxvZygpfS5cblx0ICovXG5cdGRlYnVnKG1lc3NhZ2U/OiBhbnksIC4uLm9wdGlvbmFsUGFyYW1zOiBhbnlbXSk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBVc2VzIHtAbGluayB1dGlsLmluc3BlY3QoKX0gb24gYG9iamAgYW5kIHByaW50cyB0aGUgcmVzdWx0aW5nIHN0cmluZyB0byBgc3Rkb3V0YC5cblx0ICogVGhpcyBmdW5jdGlvbiBieXBhc3NlcyBhbnkgY3VzdG9tIGBpbnNwZWN0KClgIGZ1bmN0aW9uIGRlZmluZWQgb24gYG9iamAuXG5cdCAqL1xuXHRkaXIob2JqOiBhbnksIG9wdGlvbnM/OiBOb2RlSlMuSW5zcGVjdE9wdGlvbnMpOiB2b2lkO1xuXHQvKipcblx0ICogVGhpcyBtZXRob2QgY2FsbHMge0BsaW5rIGNvbnNvbGUubG9nKCl9IHBhc3NpbmcgaXQgdGhlIGFyZ3VtZW50cyByZWNlaXZlZC4gUGxlYXNlIG5vdGUgdGhhdCB0aGlzIG1ldGhvZCBkb2VzIG5vdCBwcm9kdWNlIGFueSBYTUwgZm9ybWF0dGluZ1xuXHQgKi9cblx0ZGlyeG1sKC4uLmRhdGE6IGFueVtdKTogdm9pZDtcblx0LyoqXG5cdCAqIFByaW50cyB0byBgc3RkZXJyYCB3aXRoIG5ld2xpbmUuXG5cdCAqL1xuXHRlcnJvcihtZXNzYWdlPzogYW55LCAuLi5vcHRpb25hbFBhcmFtczogYW55W10pOiB2b2lkO1xuXHQvKipcblx0ICogSW5jcmVhc2VzIGluZGVudGF0aW9uIG9mIHN1YnNlcXVlbnQgbGluZXMgYnkgdHdvIHNwYWNlcy5cblx0ICogSWYgb25lIG9yIG1vcmUgYGxhYmVsYHMgYXJlIHByb3ZpZGVkLCB0aG9zZSBhcmUgcHJpbnRlZCBmaXJzdCB3aXRob3V0IHRoZSBhZGRpdGlvbmFsIGluZGVudGF0aW9uLlxuXHQgKi9cblx0Z3JvdXAoLi4ubGFiZWw6IGFueVtdKTogdm9pZDtcblx0LyoqXG5cdCAqIFRoZSBgY29uc29sZS5ncm91cENvbGxhcHNlZCgpYCBmdW5jdGlvbiBpcyBhbiBhbGlhcyBmb3Ige0BsaW5rIGNvbnNvbGUuZ3JvdXAoKX0uXG5cdCAqL1xuXHRncm91cENvbGxhcHNlZCgpOiB2b2lkO1xuXHQvKipcblx0ICogRGVjcmVhc2VzIGluZGVudGF0aW9uIG9mIHN1YnNlcXVlbnQgbGluZXMgYnkgdHdvIHNwYWNlcy5cblx0ICovXG5cdGdyb3VwRW5kKCk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBUaGUge0BsaW5rIGNvbnNvbGUuaW5mbygpfSBmdW5jdGlvbiBpcyBhbiBhbGlhcyBmb3Ige0BsaW5rIGNvbnNvbGUubG9nKCl9LlxuXHQgKi9cblx0aW5mbyhtZXNzYWdlPzogYW55LCAuLi5vcHRpb25hbFBhcmFtczogYW55W10pOiB2b2lkO1xuXHQvKipcblx0ICogUHJpbnRzIHRvIGBzdGRvdXRgIHdpdGggbmV3bGluZS5cblx0ICovXG5cdGxvZyhtZXNzYWdlPzogYW55LCAuLi5vcHRpb25hbFBhcmFtczogYW55W10pOiB2b2lkO1xuXHQvKipcblx0ICogVGhpcyBtZXRob2QgZG9lcyBub3QgZGlzcGxheSBhbnl0aGluZyB1bmxlc3MgdXNlZCBpbiB0aGUgaW5zcGVjdG9yLlxuXHQgKiAgUHJpbnRzIHRvIGBzdGRvdXRgIHRoZSBhcnJheSBgYXJyYXlgIGZvcm1hdHRlZCBhcyBhIHRhYmxlLlxuXHQgKi9cblx0dGFibGUodGFidWxhckRhdGE6IGFueSwgcHJvcGVydGllcz86IHN0cmluZ1tdKTogdm9pZDtcblx0LyoqXG5cdCAqIFN0YXJ0cyBhIHRpbWVyIHRoYXQgY2FuIGJlIHVzZWQgdG8gY29tcHV0ZSB0aGUgZHVyYXRpb24gb2YgYW4gb3BlcmF0aW9uLiBUaW1lcnMgYXJlIGlkZW50aWZpZWQgYnkgYSB1bmlxdWUgYGxhYmVsYC5cblx0ICovXG5cdHRpbWUobGFiZWw/OiBzdHJpbmcpOiB2b2lkO1xuXHQvKipcblx0ICogU3RvcHMgYSB0aW1lciB0aGF0IHdhcyBwcmV2aW91c2x5IHN0YXJ0ZWQgYnkgY2FsbGluZyB7QGxpbmsgY29uc29sZS50aW1lKCl9IGFuZCBwcmludHMgdGhlIHJlc3VsdCB0byBgc3Rkb3V0YC5cblx0ICovXG5cdHRpbWVFbmQobGFiZWw/OiBzdHJpbmcpOiB2b2lkO1xuXHQvKipcblx0ICogUHJpbnRzIHRvIGBzdGRlcnJgIHRoZSBzdHJpbmcgJ1RyYWNlIDonLCBmb2xsb3dlZCBieSB0aGUge0BsaW5rIHV0aWwuZm9ybWF0KCl9IGZvcm1hdHRlZCBtZXNzYWdlIGFuZCBzdGFjayB0cmFjZSB0byB0aGUgY3VycmVudCBwb3NpdGlvbiBpbiB0aGUgY29kZS5cblx0ICovXG5cdHRyYWNlKG1lc3NhZ2U/OiBhbnksIC4uLm9wdGlvbmFsUGFyYW1zOiBhbnlbXSk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBUaGUge0BsaW5rIGNvbnNvbGUud2FybigpfSBmdW5jdGlvbiBpcyBhbiBhbGlhcyBmb3Ige0BsaW5rIGNvbnNvbGUuZXJyb3IoKX0uXG5cdCAqL1xuXHR3YXJuKG1lc3NhZ2U/OiBhbnksIC4uLm9wdGlvbmFsUGFyYW1zOiBhbnlbXSk6IHZvaWQ7XG5cblx0Ly8gLS0tIEluc3BlY3RvciBtb2RlIG9ubHkgLS0tXG5cdC8qKlxuXHQgKiBUaGlzIG1ldGhvZCBkb2VzIG5vdCBkaXNwbGF5IGFueXRoaW5nIHVubGVzcyB1c2VkIGluIHRoZSBpbnNwZWN0b3IuXG5cdCAqICBTdGFydHMgYSBKYXZhU2NyaXB0IENQVSBwcm9maWxlIHdpdGggYW4gb3B0aW9uYWwgbGFiZWwuXG5cdCAqL1xuXHRwcm9maWxlKGxhYmVsPzogc3RyaW5nKTogdm9pZDtcblx0LyoqXG5cdCAqIFRoaXMgbWV0aG9kIGRvZXMgbm90IGRpc3BsYXkgYW55dGhpbmcgdW5sZXNzIHVzZWQgaW4gdGhlIGluc3BlY3Rvci5cblx0ICogIFN0b3BzIHRoZSBjdXJyZW50IEphdmFTY3JpcHQgQ1BVIHByb2ZpbGluZyBzZXNzaW9uIGlmIG9uZSBoYXMgYmVlbiBzdGFydGVkIGFuZCBwcmludHMgdGhlIHJlcG9ydCB0byB0aGUgUHJvZmlsZXMgcGFuZWwgb2YgdGhlIGluc3BlY3Rvci5cblx0ICovXG5cdHByb2ZpbGVFbmQoKTogdm9pZDtcblx0LyoqXG5cdCAqIFRoaXMgbWV0aG9kIGRvZXMgbm90IGRpc3BsYXkgYW55dGhpbmcgdW5sZXNzIHVzZWQgaW4gdGhlIGluc3BlY3Rvci5cblx0ICogIEFkZHMgYW4gZXZlbnQgd2l0aCB0aGUgbGFiZWwgYGxhYmVsYCB0byB0aGUgVGltZWxpbmUgcGFuZWwgb2YgdGhlIGluc3BlY3Rvci5cblx0ICovXG5cdHRpbWVTdGFtcChsYWJlbD86IHN0cmluZyk6IHZvaWQ7XG59XG5cbmV4cG9ydCBjbGFzcyBDb25zb2xlMlxue1xuXHRjb25zdHJ1Y3Rvcih0YXJnZXQ6IENvbnNvbGUyIHwgSUNvbnNvbGVXaXRoU3RyZWFtPENvbnNvbGU+ID0gY29uc29sZSwgb3B0aW9ucz86IElPcHRpb25zKVxuXHR7XG5cdFx0dGhpc1tTWU1fQ09OU09MRV0gPSB0YXJnZXQgfHwgY29uc29sZTtcblxuXHRcdGlmIChvcHRpb25zICYmIG9wdGlvbnMuY2hhbGtPcHRpb25zKVxuXHRcdHtcblx0XHRcdHRoaXNbU1lNX0NIQUxLXSA9IGNoYWxrLmNvbnN0cnVjdG9yKG9wdGlvbnMuY2hhbGtPcHRpb25zKTtcblx0XHR9XG5cdFx0ZWxzZVxuXHRcdHtcblx0XHRcdHRoaXNbU1lNX0NIQUxLXSA9IGNoYWxrLmNvbnN0cnVjdG9yKCk7XG5cdFx0fVxuXG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdHRoaXNbU1lNX0RBVEFdID0gT2JqZWN0LmNyZWF0ZSh7XG5cdFx0XHRjb2xvcnM6IE9iamVjdC5jcmVhdGUoZGVmYXVsdENvbG9ycyksXG5cdFx0XHQvLyBAdHMtaWdub3JlXG5cdFx0fSk7XG5cblx0XHQvLyBAdHMtaWdub3JlXG5cdFx0dGhpc1tTWU1fREFUQV0uc3RyZWFtID0gbnVsbDtcblxuXHRcdGlmICh0aGlzW1NZTV9DT05TT0xFXSBpbnN0YW5jZW9mIENvbnNvbGUyKVxuXHRcdHtcblx0XHRcdGxldCB0YXJnZXQgPSAodGhpc1tTWU1fQ09OU09MRV0gYXMgQ29uc29sZTIpLmdldFN0cmVhbSgpO1xuXG5cdFx0XHRpZiAodGFyZ2V0KVxuXHRcdFx0e1xuXHRcdFx0XHQvLyBAdHMtaWdub3JlXG5cdFx0XHRcdHRoaXNbU1lNX0RBVEFdLnN0cmVhbSA9IGhhc0NvbnNvbGVTdHJlYW0odGFyZ2V0KTtcblx0XHRcdH1cblx0XHRcdGVsc2Vcblx0XHRcdHtcblx0XHRcdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdFx0XHR0aGlzW1NZTV9EQVRBXS5zdHJlYW0gPSBmYWxzZTtcblx0XHRcdH1cblx0XHR9XG5cdFx0ZWxzZVxuXHRcdHtcblx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdHRoaXNbU1lNX0RBVEFdLnN0cmVhbSA9IGhhc0NvbnNvbGVTdHJlYW0odGhpc1tTWU1fQ09OU09MRV0pO1xuXHRcdH1cblxuXHRcdE9iamVjdC5hc3NpZ24odGhpc1tTWU1fREFUQV0sIG9wdGlvbnMgfHwge30pO1xuXG5cdFx0dGhpc1tTWU1fREFUQV0uY2hhbGtPcHRpb25zID0gdGhpc1tTWU1fREFUQV0uY2hhbGtPcHRpb25zIHx8IHt9O1xuXG5cdFx0aWYgKHRoaXNbU1lNX0RBVEFdLmNoYWxrT3B0aW9ucy5lbmFibGVkKVxuXHRcdHtcblx0XHRcdHRoaXNbU1lNX0NIQUxLXS5lbmFibGVkID0gdHJ1ZTtcblx0XHR9XG5cdFx0ZWxzZSBpZiAodGhpc1tTWU1fQ0hBTEtdLmVuYWJsZWQgJiYgIWlzTm9kZUpzKCkpXG5cdFx0e1xuXHRcdFx0dGhpc1tTWU1fQ0hBTEtdLmVuYWJsZWQgPSBmYWxzZTtcblx0XHR9XG5cdFx0ZWxzZSBpZiAoIXRoaXNbU1lNX0NIQUxLXS5lbmFibGVkICYmIGlzRm9yY2VDb2xvcigpKVxuXHRcdHtcblx0XHRcdHRoaXNbU1lNX0NIQUxLXS5lbmFibGVkID0gdHJ1ZTtcblx0XHR9XG5cblx0XHRpZiAodGhpc1tTWU1fREFUQV0uaW5zcGVjdE9wdGlvbnMgJiYgdGhpc1tTWU1fREFUQV0uaW5zcGVjdE9wdGlvbnMuZGVwdGggPCAwKVxuXHRcdHtcblx0XHRcdHRoaXNbU1lNX0RBVEFdLmluc3BlY3RPcHRpb25zLmRlcHRoID0gbnVsbDtcblx0XHR9XG5cdH1cblxuXHRnZXQgX3N0ZG91dCgpXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5nZXRTdHJlYW0oKS5fc3Rkb3V0XG5cdH1cblxuXHRnZXQgX3N0ZGVycigpXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5nZXRTdHJlYW0oKS5fc3RkZXJyXG5cdH1cblxuXHRnZXRTdHJlYW0oKToge1xuXHRcdF9zdGRvdXQ6IFdyaXRlU3RyZWFtO1xuXHRcdF9zdGRlcnI6IFdyaXRlU3RyZWFtO1xuXHR9XG5cdHtcblx0XHRpZiAodGhpc1tTWU1fREFUQV0uc3RyZWFtKVxuXHRcdHtcblx0XHRcdGxldCBfc3Rkb3V0OiBXcml0ZVN0cmVhbTtcblx0XHRcdGxldCBfc3RkZXJyOiBXcml0ZVN0cmVhbTtcblxuXHRcdFx0aWYgKHRoaXNbU1lNX0NPTlNPTEVdIGluc3RhbmNlb2YgQ29uc29sZTIpXG5cdFx0XHR7XG5cdFx0XHRcdHJldHVybiAodGhpc1tTWU1fQ09OU09MRV0gYXMgQ29uc29sZTIpLmdldFN0cmVhbSgpXG5cdFx0XHR9XG5cdFx0XHRlbHNlXG5cdFx0XHR7XG5cdFx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdFx0KHsgX3N0ZG91dCwgX3N0ZGVyciB9ID0gdGhpc1tTWU1fQ09OU09MRV0pO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRfc3Rkb3V0LFxuXHRcdFx0XHRfc3RkZXJyLFxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBudWxsO1xuXHR9XG5cblx0Z2V0IGNoYWxrKClcblx0e1xuXHRcdHJldHVybiB0aGlzW1NZTV9DSEFMS11cblx0fVxuXG5cdHNldCBjaGFsayh2YWx1ZSlcblx0e1xuXHRcdHRoaXNbU1lNX0NIQUxLXSA9IHZhbHVlXG5cdH1cblxuXHRnZXQgbGV2ZWxDb2xvcigpOiBMZXZlbFxuXHR7XG5cdFx0cmV0dXJuIHRoaXNbU1lNX0NIQUxLXS5sZXZlbFxuXHR9XG5cblx0c2V0IGxldmVsQ29sb3IodmFsdWUpXG5cdHtcblx0XHR0aGlzW1NZTV9DSEFMS10ubGV2ZWwgPSB2YWx1ZVxuXHR9XG5cblx0Z2V0IGVuYWJsZWRDb2xvcigpXG5cdHtcblx0XHRyZXR1cm4gdGhpc1tTWU1fQ0hBTEtdLmVuYWJsZWRcblx0fVxuXG5cdHNldCBlbmFibGVkQ29sb3IodmFsdWUpXG5cdHtcblx0XHR0aGlzW1NZTV9DSEFMS10uZW5hYmxlZCA9IHZhbHVlXG5cdH1cblxuXHRnZXQgY2hhbGtPcHRpb25zKClcblx0e1xuXHRcdHJldHVybiB0aGlzW1NZTV9EQVRBXS5jaGFsa09wdGlvbnNcblx0fVxuXG5cdHNldCBjaGFsa09wdGlvbnModmFsdWUpXG5cdHtcblx0XHR0aGlzW1NZTV9EQVRBXS5jaGFsa09wdGlvbnMgPSB2YWx1ZVxuXHR9XG5cblx0Z2V0IGluc3BlY3RPcHRpb25zKClcblx0e1xuXHRcdHJldHVybiB0aGlzW1NZTV9EQVRBXS5pbnNwZWN0T3B0aW9uc1xuXHR9XG5cblx0c2V0IGluc3BlY3RPcHRpb25zKHZhbHVlKVxuXHR7XG5cdFx0dGhpc1tTWU1fREFUQV0uaW5zcGVjdE9wdGlvbnMgPSB2YWx1ZVxuXHR9XG5cblx0c2V0SW5zcGVjdE9wdGlvbnModmFsdWU6IHV0aWwuSW5zcGVjdE9wdGlvbnMpXG5cdHtcblx0XHR0aGlzW1NZTV9EQVRBXS5pbnNwZWN0T3B0aW9ucyA9IE9iamVjdC5hc3NpZ24odGhpc1tTWU1fREFUQV0uaW5zcGVjdE9wdGlvbnMgfHwge30sIHZhbHVlKTtcblx0fVxuXG5cdGdldCBlbmFibGVkKClcblx0e1xuXHRcdHJldHVybiB0aGlzW1NZTV9EQVRBXS5lbmFibGVkICE9PSBmYWxzZVxuXHR9XG5cblx0c2V0IGVuYWJsZWQodmFsdWUpXG5cdHtcblx0XHR0aGlzW1NZTV9EQVRBXS5lbmFibGVkID0gdmFsdWUgPT09IHRydWVcblx0fVxuXG5cdHNldE9wdGlvbnMob3B0aW9uczogSU9wdGlvbnMpXG5cdHtcblx0XHRPYmplY3QuYXNzaWduKHRoaXNbU1lNX0RBVEFdLCBvcHRpb25zKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0d2l0aE9wdGlvbnMob3B0aW9uczogSU9wdGlvbnMpXG5cdHtcblx0XHRsZXQgbyA9IHRoaXMuX2Nsb25lKCk7XG5cblx0XHRvW1NZTV9DSEFMS10gPSB0aGlzW1NZTV9DSEFMS107XG5cblx0XHRvW1NZTV9EQVRBXSA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXNbU1lNX0RBVEFdLCBvcHRpb25zKTtcblxuXHRcdHJldHVybiBvO1xuXHR9XG5cblx0cHJvdGVjdGVkIF9jbG9uZSgpOiB0aGlzXG5cdHtcblx0XHRjb25zdCBzZWxmID0gdGhpcztcblxuXHRcdGxldCBvID0gZnVuY3Rpb24gQ29uc29sZTJNZXRob2QoLi4uYXJndilcblx0XHR7XG5cdFx0XHQvLyBAdHMtaWdub3JlXG5cdFx0XHRyZXR1cm4gby5sb2coLi4uYXJndik7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIGFsbG93IGhhY2tpbmcgcGFyZW50IG9iamVjdFxuXHRcdCAqL1xuXHRcdC8vIEB0cy1pZ25vcmVcblx0XHQvL28uX19wcm90b19fID0gdGhpcy5fX3Byb3RvX18uY29uc3RydWN0b3IucHJvdG90eXBlO1xuXHRcdG8uX19wcm90b19fID0gdGhpcztcblxuXHRcdC8vbyA9IG8uYmluZChvKTtcblxuXHRcdG9bU1lNX0NPTlNPTEVdID0gc2VsZltTWU1fQ09OU09MRV07XG5cdFx0b1tTWU1fREFUQV0gPSBzZWxmW1NZTV9EQVRBXTtcblxuXHRcdC8vIEB0cy1pZ25vcmVcblx0XHRyZXR1cm4gbztcblx0fVxuXG5cdHByb3RlY3RlZCBfY2hhbGtTdHlsZVByb3AobmFtZSlcblx0e1xuXHRcdGxldCBvID0gdGhpcy5fY2xvbmUoKTtcblx0XHRvW1NZTV9DSEFMS10gPSB0aGlzW1NZTV9DSEFMS11bbmFtZV07XG5cdFx0cmV0dXJuIG87XG5cdH1cblxuXHRwcm90ZWN0ZWQgX2xvZ0Zvcm1hdChmb3JtYXQsIC4uLmFyZ3MpXG5cdHtcblx0XHRyZXR1cm4gdXRpbC5mb3JtYXQoZm9ybWF0LCAuLi5hcmdzKTtcblx0fVxuXG5cdHN1Y2Nlc3MoLi4uYXJndilcblx0e1xuXHRcdHJldHVybiB0aGlzLl9sb2coJ3N1Y2Nlc3MnLCBhcmd2KTtcblx0fVxuXG5cdG9rKC4uLmFyZ3YpXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fbG9nKCdvaycsIGFyZ3YpO1xuXHR9XG5cblx0ZmFpbCguLi5hcmd2KVxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX2xvZygnZmFpbCcsIGFyZ3YsICdlcnJvcicpO1xuXHR9XG5cblx0cHJvdGVjdGVkIF9sYWJlbEZvcm1hdChkYXRhOiBQYXJhbWV0ZXJzPElPcHRpb25zW1wibGFiZWxGb3JtYXRGblwiXT5bMF0pXG5cdHtcblx0XHRpZiAodGhpc1tTWU1fREFUQV0ubGFiZWxGb3JtYXRGbilcblx0XHR7XG5cdFx0XHRyZXR1cm4gdGhpc1tTWU1fREFUQV0ubGFiZWxGb3JtYXRGbihkYXRhKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gYFske2RhdGEubmFtZS50b1N0cmluZygpLnRvVXBwZXJDYXNlKCl9XWBcblx0fVxuXG5cdHByb3RlY3RlZCBfbG9nKG5hbWU6IHN0cmluZywgYXJndiwgZmFpbEJhY2sgPSAnbG9nJylcblx0e1xuXHRcdGlmICghdGhpcy5lbmFibGVkKVxuXHRcdHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHQvLyBAdHMtaWdub3JlXG5cdFx0bGV0IHMgPSB0aGlzLl9sb2dGb3JtYXQoLi4uYXJndik7XG5cdFx0bGV0IG8gPSB0aGlzW1NZTV9DSEFMS10ocyk7XG5cblx0XHRsZXQgYXJyID0gW107XG5cblx0XHRsZXQgZGF0YSA9IHRoaXNbU1lNX0RBVEFdO1xuXG5cdFx0aWYgKGRhdGEudGltZSlcblx0XHR7XG5cdFx0XHRsZXQgcmV0ID0gdGhpcy5fdGltZSh7XG5cdFx0XHRcdG5hbWUsXG5cdFx0XHRcdGFyZ3YsXG5cdFx0XHRcdGZhaWxCYWNrLFxuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChyZXQgIT0gbnVsbClcblx0XHRcdHtcblx0XHRcdFx0YXJyLnB1c2gocmV0KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoZGF0YS5sYWJlbClcblx0XHR7XG5cdFx0XHRsZXQgX29rID0gdHJ1ZTtcblxuXHRcdFx0aWYgKEFycmF5LmlzQXJyYXkoZGF0YS5sYWJlbCkgJiYgIWRhdGEubGFiZWwuaW5jbHVkZXMobmFtZSkpXG5cdFx0XHR7XG5cdFx0XHRcdF9vayA9IGZhbHNlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoX29rKVxuXHRcdFx0e1xuXHRcdFx0XHRsZXQgcmV0ID0gdGhpcy5fbGFiZWxGb3JtYXQoe1xuXHRcdFx0XHRcdG5hbWUsXG5cdFx0XHRcdFx0YXJndixcblx0XHRcdFx0XHRmYWlsQmFjayxcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0aWYgKHJldCAhPSBudWxsKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0YXJyLnB1c2gocmV0KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGFyci5wdXNoKG8pO1xuXG5cdFx0aWYgKGFyci5sZW5ndGggJiYgZGF0YS5jb2xvcnMgJiYgZGF0YS5jb2xvcnNbbmFtZV0pXG5cdFx0e1xuXHRcdFx0bGV0IGM6IGFueSA9IGRhdGEuY29sb3JzW25hbWVdO1xuXG5cdFx0XHRpZiAodHlwZW9mIGMgPT09ICdzdHJpbmcnKVxuXHRcdFx0e1xuXHRcdFx0XHRjID0gY2hhbGtbY107XG5cdFx0XHR9XG5cblx0XHRcdGFyciA9IGFyci5tYXAodiA9PiBjKHYpKTtcblx0XHR9XG5cblx0XHRpZiAocHJvY2Vzcy5wbGF0Zm9ybSA9PSAnd2luMzInICYmIHRoaXMuZW5hYmxlZENvbG9yKVxuXHRcdHtcblx0XHRcdC8qKlxuXHRcdFx0ICogQEZJWE1FIGZpeCBidWcgb24gd2luZG93cyB3aGVuIGFmdGVyIGJvbGRcblx0XHRcdCAqXG5cdFx0XHQgKiBodHRwczovL2dpdGh1Yi5jb20vY2hhbGsvY2hhbGsvaXNzdWVzLzE0NSNpc3N1ZWNvbW1lbnQtMjg4OTg1OTAzXG5cdFx0XHQgKi9cblx0XHRcdGFyciA9IGFyci5tYXAodiA9PiAnXFx1MDAxQlswbScgKyB2ICsgJ1xcdTAwMUJbMG0nKTtcblx0XHR9XG5cblx0XHRpZiAoIShuYW1lIGluIHRoaXNbU1lNX0NPTlNPTEVdKSlcblx0XHR7XG5cdFx0XHRuYW1lID0gZmFpbEJhY2s7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXNbU1lNX0NPTlNPTEVdW25hbWVdKC4uLmFycik7XG5cdH1cblxuXHRwcm90ZWN0ZWQgX2NoYWxrU3R5bGVNZXRob2QobmFtZSlcblx0e1xuXHRcdHJldHVybiBmdW5jdGlvbiBjaGFsa1N0eWxlTWV0aG9kKC4uLmFyZ3YpXG5cdFx0e1xuXHRcdFx0bGV0IG8gPSB0aGlzLl9jbG9uZSgpO1xuXG5cdFx0XHRvW1NZTV9DSEFMS10gPSB0aGlzW1NZTV9DSEFMS11bbmFtZV0oLi4uYXJndik7XG5cblx0XHRcdHJldHVybiBvO1xuXHRcdH07XG5cdH1cblxuXHRwcm90ZWN0ZWQgX3RpbWUoZGF0YT86IFBhcmFtZXRlcnM8SU9wdGlvbnNbXCJsYWJlbEZvcm1hdEZuXCJdPlswXSlcblx0e1xuXHRcdGlmICh0aGlzW1NZTV9EQVRBXS50aW1lRm9ybWF0Rm4pXG5cdFx0e1xuXHRcdFx0bGV0IGRhdGEyOiBQYXJhbWV0ZXJzPElPcHRpb25zW1widGltZUZvcm1hdEZuXCJdPlswXSA9IHtcblx0XHRcdFx0Li4uZGF0YSxcblx0XHRcdFx0ZmFpbEJhY2tUaW1lRm9ybWF0OiB0aGlzW1NZTV9EQVRBXS50aW1lRm9ybWF0IHx8ICdbSEg6bW06c3MuU1NTXScsXG5cdFx0XHRcdGRhdGU6IERhdGVUaW1lLmxvY2FsKCksXG5cdFx0XHR9O1xuXG5cdFx0XHRyZXR1cm4gdGhpc1tTWU1fREFUQV0udGltZUZvcm1hdEZuKGRhdGEyKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gRGF0ZVRpbWUubG9jYWwoKS50b0Zvcm1hdCh0aGlzW1NZTV9EQVRBXS50aW1lRm9ybWF0IHx8ICdbSEg6bW06c3MuU1NTXScpO1xuXHR9XG59XG5cbnV0aWwuaW5oZXJpdHMoQ29uc29sZTIsIEZ1bmN0aW9uKTtcblxuLy8gQHRzLWlnbm9yZVxuQ29uc29sZTIucHJvdG90eXBlLkNvbnNvbGUgPSBDb25zb2xlMlxuXG5zdHlsZU5hbWVzLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpXG57XG5cdGlmIChzdHlsZU5hbWVzRm4uaW5jbHVkZXMobmFtZSBhcyBhbnkpKVxuXHR7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnNvbGUyLnByb3RvdHlwZSwgbmFtZSwge1xuXHRcdFx0Z2V0KClcblx0XHRcdHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2NoYWxrU3R5bGVNZXRob2QobmFtZSk7XG5cdFx0XHR9LFxuXHRcdH0pO1xuXHR9XG5cdGVsc2Vcblx0e1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zb2xlMi5wcm90b3R5cGUsIG5hbWUsIHtcblx0XHRcdGdldCgpXG5cdFx0XHR7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9jaGFsa1N0eWxlUHJvcChuYW1lKTtcblx0XHRcdH0sXG5cdFx0fSk7XG5cdH1cbn0pO1xuXG5GaWxsUHJvcGVydHkubWV0aG9kcy5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKVxue1xuXHRpZiAobmFtZSA9PSAnZGlyJylcblx0e1xuXHRcdENvbnNvbGUyLnByb3RvdHlwZVtuYW1lXSA9IGZ1bmN0aW9uIGNoYWxrU3R5bGVMb2dPdGhlcnMob2JqZWN0LCBvcHRpb25zKVxuXHRcdHtcblx0XHRcdGlmICghdGhpcy5lbmFibGVkKVxuXHRcdFx0e1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGxldCBlbmFibGVkQ29sb3IgPSB0aGlzLmVuYWJsZWRDb2xvcjtcblxuXHRcdFx0aWYgKCFvcHRpb25zICYmIHRoaXNbU1lNX0RBVEFdLmluc3BlY3RPcHRpb25zKVxuXHRcdFx0e1xuXHRcdFx0XHRvcHRpb25zID0gdGhpc1tTWU1fREFUQV0uaW5zcGVjdE9wdGlvbnM7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChvcHRpb25zKVxuXHRcdFx0e1xuXHRcdFx0XHRpZiAoZW5hYmxlZENvbG9yICYmIG9wdGlvbnMuY29sb3JzID09IG51bGwpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRvcHRpb25zID0ge1xuXHRcdFx0XHRcdFx0Li4ub3B0aW9ucyxcblx0XHRcdFx0XHRcdGNvbG9yczogZW5hYmxlZENvbG9yXG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB0aGlzW1NZTV9DT05TT0xFXVtuYW1lXShvYmplY3QsIG9wdGlvbnMpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpc1tTWU1fQ09OU09MRV1bbmFtZV0ob2JqZWN0LCB7XG5cdFx0XHRcdGNvbG9yczogZW5hYmxlZENvbG9yLFxuXHRcdFx0fSk7XG5cdFx0fTtcblx0fVxuXHRlbHNlIGlmIChuYW1lID09ICdhc3NlcnQnKVxuXHR7XG5cdFx0Q29uc29sZTIucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24gY2hhbGtTdHlsZUxvZ0Fzc2VydCh2YWx1ZSwgLi4uYXJndilcblx0XHR7XG5cdFx0XHRpZiAoIXRoaXMuZW5hYmxlZClcblx0XHRcdHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXZhbHVlKVxuXHRcdFx0e1xuXHRcdFx0XHRsZXQgbztcblx0XHRcdFx0aWYgKGFyZ3YubGVuZ3RoKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0bGV0IHMgPSB0aGlzLl9sb2dGb3JtYXQoLi4uYXJndik7XG5cblx0XHRcdFx0XHRvID0gdGhpc1tTWU1fQ0hBTEtdKHMpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiB0aGlzW1NZTV9DT05TT0xFXVtuYW1lXSh2YWx1ZSwgbyk7XG5cdFx0XHR9XG5cdFx0fTtcblx0fVxuXHRlbHNlIGlmIChGaWxsUHJvcGVydHkubWV0aG9kc19zdGRvdXQuaW5jbHVkZXMobmFtZSBhcyBhbnkpKVxuXHR7XG5cdFx0Q29uc29sZTIucHJvdG90eXBlW25hbWUgYXMgYW55XSA9IGZ1bmN0aW9uIGNoYWxrU3R5bGVMb2coLi4uYXJndilcblx0XHR7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbG9nKG5hbWUsIGFyZ3YpXG5cdFx0fTtcblx0fVxuXHRlbHNlIGlmIChGaWxsUHJvcGVydHkubWV0aG9kc19zdGRlcnIuaW5jbHVkZXMobmFtZSBhcyBhbnkpKVxuXHR7XG5cdFx0Q29uc29sZTIucHJvdG90eXBlW25hbWUgYXMgYW55XSA9IGZ1bmN0aW9uIGNoYWxrU3R5bGVMb2coLi4uYXJndilcblx0XHR7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbG9nKG5hbWUsIGFyZ3YsICdlcnJvcicpXG5cdFx0fTtcblx0fVxuXHRlbHNlXG5cdHtcblx0XHRDb25zb2xlMi5wcm90b3R5cGVbbmFtZSBhcyBhbnldID0gZnVuY3Rpb24gY2hhbGtTdHlsZUxvZ090aGVycyguLi5hcmd2KVxuXHRcdHtcblx0XHRcdGlmICghdGhpcy5lbmFibGVkKVxuXHRcdFx0e1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB0aGlzW1NZTV9DT05TT0xFXVtuYW1lIGFzIGFueV0oLi4uYXJndik7XG5cdFx0fTtcblx0fVxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IENvbnNvbGUyXG4iXX0=