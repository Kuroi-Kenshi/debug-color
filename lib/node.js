"use strict";
/**
 * Created by user on 2018/7/2/002.
 */
Object.defineProperty(exports, "__esModule", { value: true });
/// <reference types="node" />
const chalk_1 = require("chalk");
const luxon_1 = require("luxon");
const util = require("util");
const chk_1 = require("./chk");
const FillProperty = require("./fill-property");
const styles_1 = require("./styles");
const val_1 = require("./val");
const util_1 = require("./util");
class Console2 {
    constructor(target = console, options) {
        this[val_1.SYM_CONSOLE] = target || console;
        if (options && options.chalkOptions) {
            this[val_1.SYM_CHALK] = chalk_1.default.constructor(options.chalkOptions);
        }
        else {
            this[val_1.SYM_CHALK] = chalk_1.default.constructor();
        }
        // @ts-ignore
        this[val_1.SYM_DATA] = Object.create({
            colors: Object.create(val_1.defaultColors),
        });
        if (this[val_1.SYM_CONSOLE] instanceof Console2) {
            let target = this[val_1.SYM_CONSOLE].getStream();
            // @ts-ignore
            this[val_1.SYM_DATA].stream = util_1.hasConsoleStream(target);
        }
        else {
            // @ts-ignore
            this[val_1.SYM_DATA].stream = util_1.hasConsoleStream(target);
        }
        Object.assign(this[val_1.SYM_DATA], options || {});
        this[val_1.SYM_DATA].chalkOptions = this[val_1.SYM_DATA].chalkOptions || {};
        if (this[val_1.SYM_DATA].chalkOptions.enabled) {
            this[val_1.SYM_CHALK].enabled = true;
        }
        else if (this[val_1.SYM_CHALK].enabled && !chk_1.default()) {
            this[val_1.SYM_CHALK].enabled = false;
        }
        else if (!this[val_1.SYM_CHALK].enabled && util_1.isForceColor()) {
            this[val_1.SYM_CHALK].enabled = true;
        }
    }
    get _stdout() {
        return this.getStream()._stdout;
    }
    get _stderr() {
        return this.getStream()._stderr;
    }
    getStream() {
        if (this[val_1.SYM_DATA].stream) {
            let _stdout;
            let _stderr;
            if (this[val_1.SYM_CONSOLE] instanceof Console2) {
                return this[val_1.SYM_CONSOLE].getStream();
            }
            else {
                // @ts-ignore
                ({ _stdout, _stderr } = this[val_1.SYM_CONSOLE]);
            }
            return {
                _stdout,
                _stderr,
            };
        }
        return null;
    }
    get chalk() {
        return this[val_1.SYM_CHALK];
    }
    set chalk(value) {
        this[val_1.SYM_CHALK] = value;
    }
    get levelColor() {
        return this[val_1.SYM_CHALK].level;
    }
    set levelColor(value) {
        this[val_1.SYM_CHALK].level = value;
    }
    get enabledColor() {
        return this[val_1.SYM_CHALK].enabled;
    }
    set enabledColor(value) {
        this[val_1.SYM_CHALK].enabled = value;
    }
    get chalkOptions() {
        return this[val_1.SYM_DATA].chalkOptions;
    }
    set chalkOptions(value) {
        this[val_1.SYM_DATA].chalkOptions = value;
    }
    get inspectOptions() {
        return this[val_1.SYM_DATA].inspectOptions;
    }
    set inspectOptions(value) {
        this[val_1.SYM_DATA].inspectOptions = value;
    }
    setInspectOptions(value) {
        this[val_1.SYM_DATA].inspectOptions = Object.assign(this[val_1.SYM_DATA].inspectOptions || {}, value);
    }
    get enabled() {
        return this[val_1.SYM_DATA].enabled !== false;
    }
    set enabled(value) {
        this[val_1.SYM_DATA].enabled = value === true;
    }
    setOptions(options) {
        Object.assign(this[val_1.SYM_DATA], options);
        return this;
    }
    withOptions(options) {
        let o = this._clone();
        o[val_1.SYM_CHALK] = this[val_1.SYM_CHALK];
        o[val_1.SYM_DATA] = Object.assign({}, this[val_1.SYM_DATA], options);
        return o;
    }
    _clone() {
        const self = this;
        let o = function Console2Method(...argv) {
            // @ts-ignore
            return o.log(...argv);
        };
        /**
         * allow hacking parent object
         */
        // @ts-ignore
        //o.__proto__ = this.__proto__.constructor.prototype;
        o.__proto__ = this;
        //o = o.bind(o);
        o[val_1.SYM_CONSOLE] = self[val_1.SYM_CONSOLE];
        o[val_1.SYM_DATA] = self[val_1.SYM_DATA];
        // @ts-ignore
        return o;
    }
    _chalkStyleProp(name) {
        let o = this._clone();
        o[val_1.SYM_CHALK] = this[val_1.SYM_CHALK][name];
        return o;
    }
    _logFormat(format, ...args) {
        return util.format(format, ...args);
    }
    success(...argv) {
        return this._log('success', argv);
    }
    ok(...argv) {
        return this._log('ok', argv);
    }
    fail(...argv) {
        return this._log('fail', argv, 'error');
    }
    _labelFormat(data) {
        if (this[val_1.SYM_DATA].labelFormatFn) {
            return this[val_1.SYM_DATA].labelFormatFn(data);
        }
        return `[${data.name.toString().toUpperCase()}]`;
    }
    _log(name, argv, failBack = 'log') {
        if (!this.enabled) {
            return;
        }
        // @ts-ignore
        let s = this._logFormat(...argv);
        let o = this[val_1.SYM_CHALK](s);
        let arr = [];
        let data = this[val_1.SYM_DATA];
        if (data.time) {
            let ret = this._time({
                name,
                argv,
                failBack,
            });
            if (ret != null) {
                arr.push(ret);
            }
        }
        if (data.label) {
            let _ok = true;
            if (Array.isArray(data.label) && !data.label.includes(name)) {
                _ok = false;
            }
            if (_ok) {
                let ret = this._labelFormat({
                    name,
                    argv,
                    failBack,
                });
                if (ret != null) {
                    arr.push(ret);
                }
            }
        }
        arr.push(o);
        if (arr.length && data.colors && data.colors[name]) {
            let c = data.colors[name];
            if (typeof c === 'string') {
                c = chalk_1.default[c];
            }
            arr = arr.map(v => c(v));
        }
        if (process.platform == 'win32' && this.enabledColor) {
            /**
             * @FIXME fix bug on windows when after bold
             *
             * https://github.com/chalk/chalk/issues/145#issuecomment-288985903
             */
            arr = arr.map(v => '\u001B[0m' + v + '\u001B[0m');
        }
        if (!(name in this[val_1.SYM_CONSOLE])) {
            name = failBack;
        }
        return this[val_1.SYM_CONSOLE][name](...arr);
    }
    _chalkStyleMethod(name) {
        return function chalkStyleMethod(...argv) {
            let o = this._clone();
            o[val_1.SYM_CHALK] = this[val_1.SYM_CHALK][name](...argv);
            return o;
        };
    }
    _time(data) {
        if (this[val_1.SYM_DATA].timeFormatFn) {
            let data2 = {
                ...data,
                failBackTimeFormat: this[val_1.SYM_DATA].timeFormat || '[HH:mm:ss.SSS]',
                date: luxon_1.DateTime.local(),
            };
            return this[val_1.SYM_DATA].timeFormatFn(data2);
        }
        return luxon_1.DateTime.local().toFormat(this[val_1.SYM_DATA].timeFormat || '[HH:mm:ss.SSS]');
    }
}
exports.Console2 = Console2;
util.inherits(Console2, Function);
// @ts-ignore
Console2.prototype.Console = Console2;
styles_1.styleNames.forEach(function (name) {
    if (styles_1.styleNamesFn.includes(name)) {
        Object.defineProperty(Console2.prototype, name, {
            get() {
                return this._chalkStyleMethod(name);
            },
        });
    }
    else {
        Object.defineProperty(Console2.prototype, name, {
            get() {
                return this._chalkStyleProp(name);
            },
        });
    }
});
FillProperty.methods.forEach(function (name) {
    if (name == 'dir') {
        Console2.prototype[name] = function chalkStyleLogOthers(object, options) {
            if (!this.enabled) {
                return;
            }
            if (!options && this[val_1.SYM_DATA].inspectOptions) {
                options = this[val_1.SYM_DATA].inspectOptions;
            }
            if (options) {
                return this[val_1.SYM_CONSOLE][name](object, options);
            }
            return this[val_1.SYM_CONSOLE][name](object);
        };
    }
    else if (name == 'assert') {
        Console2.prototype[name] = function chalkStyleLogAssert(value, ...argv) {
            if (!this.enabled) {
                return;
            }
            if (!value) {
                let o;
                if (argv.length) {
                    let s = this._logFormat(...argv);
                    o = this[val_1.SYM_CHALK](s);
                }
                return this[val_1.SYM_CONSOLE][name](value, o);
            }
        };
    }
    else if (FillProperty.methods_stdout.includes(name)) {
        Console2.prototype[name] = function chalkStyleLog(...argv) {
            return this._log(name, argv);
        };
    }
    else if (FillProperty.methods_stderr.includes(name)) {
        Console2.prototype[name] = function chalkStyleLog(...argv) {
            return this._log(name, argv, 'error');
        };
    }
    else {
        Console2.prototype[name] = function chalkStyleLogOthers(...argv) {
            if (!this.enabled) {
                return;
            }
            return this[val_1.SYM_CONSOLE][name](...argv);
        };
    }
});
exports.default = Console2;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9kZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm5vZGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOztBQUVILDhCQUE4QjtBQUU5QixpQ0FBMEQ7QUFFMUQsaUNBQWlDO0FBQ2pDLDZCQUE4QjtBQUM5QiwrQkFBNkI7QUFDN0IsZ0RBQWlEO0FBQ2pELHFDQUE2RDtBQUM3RCwrQkFBa0Y7QUFDbEYsaUNBQXdEO0FBb0h4RCxNQUFhLFFBQVE7SUFFcEIsWUFBWSxTQUFpRCxPQUFPLEVBQUUsT0FBa0I7UUFFdkYsSUFBSSxDQUFDLGlCQUFXLENBQUMsR0FBRyxNQUFNLElBQUksT0FBTyxDQUFDO1FBRXRDLElBQUksT0FBTyxJQUFJLE9BQU8sQ0FBQyxZQUFZLEVBQ25DO1lBQ0MsSUFBSSxDQUFDLGVBQVMsQ0FBQyxHQUFHLGVBQUssQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQzFEO2FBRUQ7WUFDQyxJQUFJLENBQUMsZUFBUyxDQUFDLEdBQUcsZUFBSyxDQUFDLFdBQVcsRUFBRSxDQUFDO1NBQ3RDO1FBRUQsYUFBYTtRQUNiLElBQUksQ0FBQyxjQUFRLENBQUMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDO1lBQzlCLE1BQU0sRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLG1CQUFhLENBQUM7U0FDcEMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxJQUFJLENBQUMsaUJBQVcsQ0FBQyxZQUFZLFFBQVEsRUFDekM7WUFDQyxJQUFJLE1BQU0sR0FBSSxJQUFJLENBQUMsaUJBQVcsQ0FBYyxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBRXpELGFBQWE7WUFDYixJQUFJLENBQUMsY0FBUSxDQUFDLENBQUMsTUFBTSxHQUFHLHVCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ2pEO2FBRUQ7WUFDQyxhQUFhO1lBQ2IsSUFBSSxDQUFDLGNBQVEsQ0FBQyxDQUFDLE1BQU0sR0FBRyx1QkFBZ0IsQ0FBQyxNQUFNLENB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ZSxRQUFRLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENyZWF0ZWQgYnkgdXNlciBvbiAyMDE4LzcvMi8wMDIuXG4gKi9cblxuLy8vIDxyZWZlcmVuY2UgdHlwZXM9XCJub2RlXCIgLz5cblxuaW1wb3J0IGNoYWxrLCB7IENoYWxrLCBMZXZlbCwgQ2hhbGtPcHRpb25zIH0gZnJvbSAnY2hhbGsnO1xuaW1wb3J0IHsgQ29uc29sZSB9IGZyb20gJ2NvbnNvbGUnO1xuaW1wb3J0IHsgRGF0ZVRpbWUgfSBmcm9tICdsdXhvbic7XG5pbXBvcnQgdXRpbCA9IHJlcXVpcmUoJ3V0aWwnKTtcbmltcG9ydCBpc05vZGVKcyBmcm9tICcuL2Noayc7XG5pbXBvcnQgRmlsbFByb3BlcnR5ID0gcmVxdWlyZSgnLi9maWxsLXByb3BlcnR5Jyk7XG5pbXBvcnQgeyBJU3R5bGVzLCBzdHlsZU5hbWVzLCBzdHlsZU5hbWVzRm4gfSBmcm9tICcuL3N0eWxlcyc7XG5pbXBvcnQgeyBkZWZhdWx0Q29sb3JzLCBJT3B0aW9ucywgU1lNX0NIQUxLLCBTWU1fQ09OU09MRSwgU1lNX0RBVEEgfSBmcm9tICcuL3ZhbCc7XG5pbXBvcnQgeyBoYXNDb25zb2xlU3RyZWFtLCBpc0ZvcmNlQ29sb3IgfSBmcm9tICcuL3V0aWwnO1xuaW1wb3J0IFdyaXRlU3RyZWFtID0gTm9kZUpTLldyaXRlU3RyZWFtO1xuXG5leHBvcnQgdHlwZSBJQ29uc29sZVdpdGhTdHJlYW08VCBleHRlbmRzIG9iamVjdCA9IENvbnNvbGU+ID0gVCAmIHtcblx0X3N0ZG91dD86IFdyaXRlU3RyZWFtO1xuXHRfc3RkZXJyPzogV3JpdGVTdHJlYW07XG59XG5cbmV4cG9ydCB7IEluc3BlY3RPcHRpb25zIH0gZnJvbSAndXRpbCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29uc29sZTIgZXh0ZW5kcyBJQ29uc29sZVdpdGhTdHJlYW08Q29uc29sZT4sIElTdHlsZXNcbntcblx0KC4uLmFyZ3YpOiB2b2lkXG5cblx0W1NZTV9DT05TT0xFXTogSUNvbnNvbGVXaXRoU3RyZWFtPENvbnNvbGU+IHwgQ29uc29sZTI7XG5cdFtTWU1fQ0hBTEtdOiBDaGFsaztcblxuXHRbU1lNX0RBVEFdOiBJT3B0aW9uc1xuXG5cdC8qKlxuXHQgKiBBIHNpbXBsZSBhc3NlcnRpb24gdGVzdCB0aGF0IHZlcmlmaWVzIHdoZXRoZXIgYHZhbHVlYCBpcyB0cnV0aHkuXG5cdCAqIElmIGl0IGlzIG5vdCwgYW4gYEFzc2VydGlvbkVycm9yYCBpcyB0aHJvd24uXG5cdCAqIElmIHByb3ZpZGVkLCB0aGUgZXJyb3IgYG1lc3NhZ2VgIGlzIGZvcm1hdHRlZCB1c2luZyBgdXRpbC5mb3JtYXQoKWAgYW5kIHVzZWQgYXMgdGhlIGVycm9yIG1lc3NhZ2UuXG5cdCAqL1xuXHRhc3NlcnQodmFsdWU6IGFueSwgbWVzc2FnZT86IHN0cmluZywgLi4ub3B0aW9uYWxQYXJhbXM6IGFueVtdKTogdm9pZDtcblx0LyoqXG5cdCAqIFdoZW4gYHN0ZG91dGAgaXMgYSBUVFksIGNhbGxpbmcgYGNvbnNvbGUuY2xlYXIoKWAgd2lsbCBhdHRlbXB0IHRvIGNsZWFyIHRoZSBUVFkuXG5cdCAqIFdoZW4gYHN0ZG91dGAgaXMgbm90IGEgVFRZLCB0aGlzIG1ldGhvZCBkb2VzIG5vdGhpbmcuXG5cdCAqL1xuXHRjbGVhcigpOiB2b2lkO1xuXHQvKipcblx0ICogTWFpbnRhaW5zIGFuIGludGVybmFsIGNvdW50ZXIgc3BlY2lmaWMgdG8gYGxhYmVsYCBhbmQgb3V0cHV0cyB0byBgc3Rkb3V0YCB0aGUgbnVtYmVyIG9mIHRpbWVzIGBjb25zb2xlLmNvdW50KClgIGhhcyBiZWVuIGNhbGxlZCB3aXRoIHRoZSBnaXZlbiBgbGFiZWxgLlxuXHQgKi9cblx0Y291bnQobGFiZWw/OiBzdHJpbmcpOiB2b2lkO1xuXHQvKipcblx0ICogUmVzZXRzIHRoZSBpbnRlcm5hbCBjb3VudGVyIHNwZWNpZmljIHRvIGBsYWJlbGAuXG5cdCAqL1xuXHRjb3VudFJlc2V0KGxhYmVsPzogc3RyaW5nKTogdm9pZDtcblx0LyoqXG5cdCAqIFRoZSBgY29uc29sZS5kZWJ1ZygpYCBmdW5jdGlvbiBpcyBhbiBhbGlhcyBmb3Ige0BsaW5rIGNvbnNvbGUubG9nKCl9LlxuXHQgKi9cblx0ZGVidWcobWVzc2FnZT86IGFueSwgLi4ub3B0aW9uYWxQYXJhbXM6IGFueVtdKTogdm9pZDtcblx0LyoqXG5cdCAqIFVzZXMge0BsaW5rIHV0aWwuaW5zcGVjdCgpfSBvbiBgb2JqYCBhbmQgcHJpbnRzIHRoZSByZXN1bHRpbmcgc3RyaW5nIHRvIGBzdGRvdXRgLlxuXHQgKiBUaGlzIGZ1bmN0aW9uIGJ5cGFzc2VzIGFueSBjdXN0b20gYGluc3BlY3QoKWAgZnVuY3Rpb24gZGVmaW5lZCBvbiBgb2JqYC5cblx0ICovXG5cdGRpcihvYmo6IGFueSwgb3B0aW9ucz86IE5vZGVKUy5JbnNwZWN0T3B0aW9ucyk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBUaGlzIG1ldGhvZCBjYWxscyB7QGxpbmsgY29uc29sZS5sb2coKX0gcGFzc2luZyBpdCB0aGUgYXJndW1lbnRzIHJlY2VpdmVkLiBQbGVhc2Ugbm90ZSB0aGF0IHRoaXMgbWV0aG9kIGRvZXMgbm90IHByb2R1Y2UgYW55IFhNTCBmb3JtYXR0aW5nXG5cdCAqL1xuXHRkaXJ4bWwoLi4uZGF0YTogYW55W10pOiB2b2lkO1xuXHQvKipcblx0ICogUHJpbnRzIHRvIGBzdGRlcnJgIHdpdGggbmV3bGluZS5cblx0ICovXG5cdGVycm9yKG1lc3NhZ2U/OiBhbnksIC4uLm9wdGlvbmFsUGFyYW1zOiBhbnlbXSk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBJbmNyZWFzZXMgaW5kZW50YXRpb24gb2Ygc3Vic2VxdWVudCBsaW5lcyBieSB0d28gc3BhY2VzLlxuXHQgKiBJZiBvbmUgb3IgbW9yZSBgbGFiZWxgcyBhcmUgcHJvdmlkZWQsIHRob3NlIGFyZSBwcmludGVkIGZpcnN0IHdpdGhvdXQgdGhlIGFkZGl0aW9uYWwgaW5kZW50YXRpb24uXG5cdCAqL1xuXHRncm91cCguLi5sYWJlbDogYW55W10pOiB2b2lkO1xuXHQvKipcblx0ICogVGhlIGBjb25zb2xlLmdyb3VwQ29sbGFwc2VkKClgIGZ1bmN0aW9uIGlzIGFuIGFsaWFzIGZvciB7QGxpbmsgY29uc29sZS5ncm91cCgpfS5cblx0ICovXG5cdGdyb3VwQ29sbGFwc2VkKCk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBEZWNyZWFzZXMgaW5kZW50YXRpb24gb2Ygc3Vic2VxdWVudCBsaW5lcyBieSB0d28gc3BhY2VzLlxuXHQgKi9cblx0Z3JvdXBFbmQoKTogdm9pZDtcblx0LyoqXG5cdCAqIFRoZSB7QGxpbmsgY29uc29sZS5pbmZvKCl9IGZ1bmN0aW9uIGlzIGFuIGFsaWFzIGZvciB7QGxpbmsgY29uc29sZS5sb2coKX0uXG5cdCAqL1xuXHRpbmZvKG1lc3NhZ2U/OiBhbnksIC4uLm9wdGlvbmFsUGFyYW1zOiBhbnlbXSk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBQcmludHMgdG8gYHN0ZG91dGAgd2l0aCBuZXdsaW5lLlxuXHQgKi9cblx0bG9nKG1lc3NhZ2U/OiBhbnksIC4uLm9wdGlvbmFsUGFyYW1zOiBhbnlbXSk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBUaGlzIG1ldGhvZCBkb2VzIG5vdCBkaXNwbGF5IGFueXRoaW5nIHVubGVzcyB1c2VkIGluIHRoZSBpbnNwZWN0b3IuXG5cdCAqICBQcmludHMgdG8gYHN0ZG91dGAgdGhlIGFycmF5IGBhcnJheWAgZm9ybWF0dGVkIGFzIGEgdGFibGUuXG5cdCAqL1xuXHR0YWJsZSh0YWJ1bGFyRGF0YTogYW55LCBwcm9wZXJ0aWVzPzogc3RyaW5nW10pOiB2b2lkO1xuXHQvKipcblx0ICogU3RhcnRzIGEgdGltZXIgdGhhdCBjYW4gYmUgdXNlZCB0byBjb21wdXRlIHRoZSBkdXJhdGlvbiBvZiBhbiBvcGVyYXRpb24uIFRpbWVycyBhcmUgaWRlbnRpZmllZCBieSBhIHVuaXF1ZSBgbGFiZWxgLlxuXHQgKi9cblx0dGltZShsYWJlbD86IHN0cmluZyk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBTdG9wcyBhIHRpbWVyIHRoYXQgd2FzIHByZXZpb3VzbHkgc3RhcnRlZCBieSBjYWxsaW5nIHtAbGluayBjb25zb2xlLnRpbWUoKX0gYW5kIHByaW50cyB0aGUgcmVzdWx0IHRvIGBzdGRvdXRgLlxuXHQgKi9cblx0dGltZUVuZChsYWJlbD86IHN0cmluZyk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBQcmludHMgdG8gYHN0ZGVycmAgdGhlIHN0cmluZyAnVHJhY2UgOicsIGZvbGxvd2VkIGJ5IHRoZSB7QGxpbmsgdXRpbC5mb3JtYXQoKX0gZm9ybWF0dGVkIG1lc3NhZ2UgYW5kIHN0YWNrIHRyYWNlIHRvIHRoZSBjdXJyZW50IHBvc2l0aW9uIGluIHRoZSBjb2RlLlxuXHQgKi9cblx0dHJhY2UobWVzc2FnZT86IGFueSwgLi4ub3B0aW9uYWxQYXJhbXM6IGFueVtdKTogdm9pZDtcblx0LyoqXG5cdCAqIFRoZSB7QGxpbmsgY29uc29sZS53YXJuKCl9IGZ1bmN0aW9uIGlzIGFuIGFsaWFzIGZvciB7QGxpbmsgY29uc29sZS5lcnJvcigpfS5cblx0ICovXG5cdHdhcm4obWVzc2FnZT86IGFueSwgLi4ub3B0aW9uYWxQYXJhbXM6IGFueVtdKTogdm9pZDtcblxuXHQvLyAtLS0gSW5zcGVjdG9yIG1vZGUgb25seSAtLS1cblx0LyoqXG5cdCAqIFRoaXMgbWV0aG9kIGRvZXMgbm90IGRpc3BsYXkgYW55dGhpbmcgdW5sZXNzIHVzZWQgaW4gdGhlIGluc3BlY3Rvci5cblx0ICogIFN0YXJ0cyBhIEphdmFTY3JpcHQgQ1BVIHByb2ZpbGUgd2l0aCBhbiBvcHRpb25hbCBsYWJlbC5cblx0ICovXG5cdHByb2ZpbGUobGFiZWw/OiBzdHJpbmcpOiB2b2lkO1xuXHQvKipcblx0ICogVGhpcyBtZXRob2QgZG9lcyBub3QgZGlzcGxheSBhbnl0aGluZyB1bmxlc3MgdXNlZCBpbiB0aGUgaW5zcGVjdG9yLlxuXHQgKiAgU3RvcHMgdGhlIGN1cnJlbnQgSmF2YVNjcmlwdCBDUFUgcHJvZmlsaW5nIHNlc3Npb24gaWYgb25lIGhhcyBiZWVuIHN0YXJ0ZWQgYW5kIHByaW50cyB0aGUgcmVwb3J0IHRvIHRoZSBQcm9maWxlcyBwYW5lbCBvZiB0aGUgaW5zcGVjdG9yLlxuXHQgKi9cblx0cHJvZmlsZUVuZCgpOiB2b2lkO1xuXHQvKipcblx0ICogVGhpcyBtZXRob2QgZG9lcyBub3QgZGlzcGxheSBhbnl0aGluZyB1bmxlc3MgdXNlZCBpbiB0aGUgaW5zcGVjdG9yLlxuXHQgKiAgQWRkcyBhbiBldmVudCB3aXRoIHRoZSBsYWJlbCBgbGFiZWxgIHRvIHRoZSBUaW1lbGluZSBwYW5lbCBvZiB0aGUgaW5zcGVjdG9yLlxuXHQgKi9cblx0dGltZVN0YW1wKGxhYmVsPzogc3RyaW5nKTogdm9pZDtcbn1cblxuZXhwb3J0IGNsYXNzIENvbnNvbGUyXG57XG5cdGNvbnN0cnVjdG9yKHRhcmdldDogQ29uc29sZTIgfCBJQ29uc29sZVdpdGhTdHJlYW08Q29uc29sZT4gPSBjb25zb2xlLCBvcHRpb25zPzogSU9wdGlvbnMpXG5cdHtcblx0XHR0aGlzW1NZTV9DT05TT0xFXSA9IHRhcmdldCB8fCBjb25zb2xlO1xuXG5cdFx0aWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jaGFsa09wdGlvbnMpXG5cdFx0e1xuXHRcdFx0dGhpc1tTWU1fQ0hBTEtdID0gY2hhbGsuY29uc3RydWN0b3Iob3B0aW9ucy5jaGFsa09wdGlvbnMpO1xuXHRcdH1cblx0XHRlbHNlXG5cdFx0e1xuXHRcdFx0dGhpc1tTWU1fQ0hBTEtdID0gY2hhbGsuY29uc3RydWN0b3IoKTtcblx0XHR9XG5cblx0XHQvLyBAdHMtaWdub3JlXG5cdFx0dGhpc1tTWU1fREFUQV0gPSBPYmplY3QuY3JlYXRlKHtcblx0XHRcdGNvbG9yczogT2JqZWN0LmNyZWF0ZShkZWZhdWx0Q29sb3JzKSxcblx0XHR9KTtcblxuXHRcdGlmICh0aGlzW1NZTV9DT05TT0xFXSBpbnN0YW5jZW9mIENvbnNvbGUyKVxuXHRcdHtcblx0XHRcdGxldCB0YXJnZXQgPSAodGhpc1tTWU1fQ09OU09MRV0gYXMgQ29uc29sZTIpLmdldFN0cmVhbSgpO1xuXG5cdFx0XHQvLyBAdHMtaWdub3JlXG5cdFx0XHR0aGlzW1NZTV9EQVRBXS5zdHJlYW0gPSBoYXNDb25zb2xlU3RyZWFtKHRhcmdldCk7XG5cdFx0fVxuXHRcdGVsc2Vcblx0XHR7XG5cdFx0XHQvLyBAdHMtaWdub3JlXG5cdFx0XHR0aGlzW1NZTV9EQVRBXS5zdHJlYW0gPSBoYXNDb25zb2xlU3RyZWFtKHRhcmdldCk7XG5cdFx0fVxuXG5cdFx0T2JqZWN0LmFzc2lnbih0aGlzW1NZTV9EQVRBXSwgb3B0aW9ucyB8fCB7fSk7XG5cblx0XHR0aGlzW1NZTV9EQVRBXS5jaGFsa09wdGlvbnMgPSB0aGlzW1NZTV9EQVRBXS5jaGFsa09wdGlvbnMgfHwge307XG5cblx0XHRpZiAodGhpc1tTWU1fREFUQV0uY2hhbGtPcHRpb25zLmVuYWJsZWQpXG5cdFx0e1xuXHRcdFx0dGhpc1tTWU1fQ0hBTEtdLmVuYWJsZWQgPSB0cnVlO1xuXHRcdH1cblx0XHRlbHNlIGlmICh0aGlzW1NZTV9DSEFMS10uZW5hYmxlZCAmJiAhaXNOb2RlSnMoKSlcblx0XHR7XG5cdFx0XHR0aGlzW1NZTV9DSEFMS10uZW5hYmxlZCA9IGZhbHNlO1xuXHRcdH1cblx0XHRlbHNlIGlmICghdGhpc1tTWU1fQ0hBTEtdLmVuYWJsZWQgJiYgaXNGb3JjZUNvbG9yKCkpXG5cdFx0e1xuXHRcdFx0dGhpc1tTWU1fQ0hBTEtdLmVuYWJsZWQgPSB0cnVlO1xuXHRcdH1cblx0fVxuXG5cdGdldCBfc3Rkb3V0KClcblx0e1xuXHRcdHJldHVybiB0aGlzLmdldFN0cmVhbSgpLl9zdGRvdXRcblx0fVxuXG5cdGdldCBfc3RkZXJyKClcblx0e1xuXHRcdHJldHVybiB0aGlzLmdldFN0cmVhbSgpLl9zdGRlcnJcblx0fVxuXG5cdGdldFN0cmVhbSgpOiB7XG5cdFx0X3N0ZG91dDogV3JpdGVTdHJlYW07XG5cdFx0X3N0ZGVycjogV3JpdGVTdHJlYW07XG5cdH1cblx0e1xuXHRcdGlmICh0aGlzW1NZTV9EQVRBXS5zdHJlYW0pXG5cdFx0e1xuXHRcdFx0bGV0IF9zdGRvdXQ6IFdyaXRlU3RyZWFtO1xuXHRcdFx0bGV0IF9zdGRlcnI6IFdyaXRlU3RyZWFtO1xuXG5cdFx0XHRpZiAodGhpc1tTWU1fQ09OU09MRV0gaW5zdGFuY2VvZiBDb25zb2xlMilcblx0XHRcdHtcblx0XHRcdFx0cmV0dXJuICh0aGlzW1NZTV9DT05TT0xFXSBhcyBDb25zb2xlMikuZ2V0U3RyZWFtKClcblx0XHRcdH1cblx0XHRcdGVsc2Vcblx0XHRcdHtcblx0XHRcdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdFx0XHQoeyBfc3Rkb3V0LCBfc3RkZXJyIH0gPSB0aGlzW1NZTV9DT05TT0xFXSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdF9zdGRvdXQsXG5cdFx0XHRcdF9zdGRlcnIsXG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cblxuXHRnZXQgY2hhbGsoKVxuXHR7XG5cdFx0cmV0dXJuIHRoaXNbU1lNX0NIQUxLXVxuXHR9XG5cblx0c2V0IGNoYWxrKHZhbHVlKVxuXHR7XG5cdFx0dGhpc1tTWU1fQ0hBTEtdID0gdmFsdWVcblx0fVxuXG5cdGdldCBsZXZlbENvbG9yKCk6IExldmVsXG5cdHtcblx0XHRyZXR1cm4gdGhpc1tTWU1fQ0hBTEtdLmxldmVsXG5cdH1cblxuXHRzZXQgbGV2ZWxDb2xvcih2YWx1ZSlcblx0e1xuXHRcdHRoaXNbU1lNX0NIQUxLXS5sZXZlbCA9IHZhbHVlXG5cdH1cblxuXHRnZXQgZW5hYmxlZENvbG9yKClcblx0e1xuXHRcdHJldHVybiB0aGlzW1NZTV9DSEFMS10uZW5hYmxlZFxuXHR9XG5cblx0c2V0IGVuYWJsZWRDb2xvcih2YWx1ZSlcblx0e1xuXHRcdHRoaXNbU1lNX0NIQUxLXS5lbmFibGVkID0gdmFsdWVcblx0fVxuXG5cdGdldCBjaGFsa09wdGlvbnMoKVxuXHR7XG5cdFx0cmV0dXJuIHRoaXNbU1lNX0RBVEFdLmNoYWxrT3B0aW9uc1xuXHR9XG5cblx0c2V0IGNoYWxrT3B0aW9ucyh2YWx1ZSlcblx0e1xuXHRcdHRoaXNbU1lNX0RBVEFdLmNoYWxrT3B0aW9ucyA9IHZhbHVlXG5cdH1cblxuXHRnZXQgaW5zcGVjdE9wdGlvbnMoKVxuXHR7XG5cdFx0cmV0dXJuIHRoaXNbU1lNX0RBVEFdLmluc3BlY3RPcHRpb25zXG5cdH1cblxuXHRzZXQgaW5zcGVjdE9wdGlvbnModmFsdWUpXG5cdHtcblx0XHR0aGlzW1NZTV9EQVRBXS5pbnNwZWN0T3B0aW9ucyA9IHZhbHVlXG5cdH1cblxuXHRzZXRJbnNwZWN0T3B0aW9ucyh2YWx1ZTogdXRpbC5JbnNwZWN0T3B0aW9ucylcblx0e1xuXHRcdHRoaXNbU1lNX0RBVEFdLmluc3BlY3RPcHRpb25zID0gT2JqZWN0LmFzc2lnbih0aGlzW1NZTV9EQVRBXS5pbnNwZWN0T3B0aW9ucyB8fCB7fSwgdmFsdWUpO1xuXHR9XG5cblx0Z2V0IGVuYWJsZWQoKVxuXHR7XG5cdFx0cmV0dXJuIHRoaXNbU1lNX0RBVEFdLmVuYWJsZWQgIT09IGZhbHNlXG5cdH1cblxuXHRzZXQgZW5hYmxlZCh2YWx1ZSlcblx0e1xuXHRcdHRoaXNbU1lNX0RBVEFdLmVuYWJsZWQgPSB2YWx1ZSA9PT0gdHJ1ZVxuXHR9XG5cblx0c2V0T3B0aW9ucyhvcHRpb25zOiBJT3B0aW9ucylcblx0e1xuXHRcdE9iamVjdC5hc3NpZ24odGhpc1tTWU1fREFUQV0sIG9wdGlvbnMpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHR3aXRoT3B0aW9ucyhvcHRpb25zOiBJT3B0aW9ucylcblx0e1xuXHRcdGxldCBvID0gdGhpcy5fY2xvbmUoKTtcblxuXHRcdG9bU1lNX0NIQUxLXSA9IHRoaXNbU1lNX0NIQUxLXTtcblxuXHRcdG9bU1lNX0RBVEFdID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpc1tTWU1fREFUQV0sIG9wdGlvbnMpO1xuXG5cdFx0cmV0dXJuIG87XG5cdH1cblxuXHRwcm90ZWN0ZWQgX2Nsb25lKCk6IHRoaXNcblx0e1xuXHRcdGNvbnN0IHNlbGYgPSB0aGlzO1xuXG5cdFx0bGV0IG8gPSBmdW5jdGlvbiBDb25zb2xlMk1ldGhvZCguLi5hcmd2KVxuXHRcdHtcblx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdHJldHVybiBvLmxvZyguLi5hcmd2KTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogYWxsb3cgaGFja2luZyBwYXJlbnQgb2JqZWN0XG5cdFx0ICovXG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdC8vby5fX3Byb3RvX18gPSB0aGlzLl9fcHJvdG9fXy5jb25zdHJ1Y3Rvci5wcm90b3R5cGU7XG5cdFx0by5fX3Byb3RvX18gPSB0aGlzO1xuXG5cdFx0Ly9vID0gby5iaW5kKG8pO1xuXG5cdFx0b1tTWU1fQ09OU09MRV0gPSBzZWxmW1NZTV9DT05TT0xFXTtcblx0XHRvW1NZTV9EQVRBXSA9IHNlbGZbU1lNX0RBVEFdO1xuXG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdHJldHVybiBvO1xuXHR9XG5cblx0cHJvdGVjdGVkIF9jaGFsa1N0eWxlUHJvcChuYW1lKVxuXHR7XG5cdFx0bGV0IG8gPSB0aGlzLl9jbG9uZSgpO1xuXHRcdG9bU1lNX0NIQUxLXSA9IHRoaXNbU1lNX0NIQUxLXVtuYW1lXTtcblx0XHRyZXR1cm4gbztcblx0fVxuXG5cdHByb3RlY3RlZCBfbG9nRm9ybWF0KGZvcm1hdCwgLi4uYXJncylcblx0e1xuXHRcdHJldHVybiB1dGlsLmZvcm1hdChmb3JtYXQsIC4uLmFyZ3MpO1xuXHR9XG5cblx0c3VjY2VzcyguLi5hcmd2KVxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX2xvZygnc3VjY2VzcycsIGFyZ3YpO1xuXHR9XG5cblx0b2soLi4uYXJndilcblx0e1xuXHRcdHJldHVybiB0aGlzLl9sb2coJ29rJywgYXJndik7XG5cdH1cblxuXHRmYWlsKC4uLmFyZ3YpXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fbG9nKCdmYWlsJywgYXJndiwgJ2Vycm9yJyk7XG5cdH1cblxuXHRwcm90ZWN0ZWQgX2xhYmVsRm9ybWF0KGRhdGE6IFBhcmFtZXRlcnM8SU9wdGlvbnNbXCJsYWJlbEZvcm1hdEZuXCJdPlswXSlcblx0e1xuXHRcdGlmICh0aGlzW1NZTV9EQVRBXS5sYWJlbEZvcm1hdEZuKVxuXHRcdHtcblx0XHRcdHJldHVybiB0aGlzW1NZTV9EQVRBXS5sYWJlbEZvcm1hdEZuKGRhdGEpO1xuXHRcdH1cblxuXHRcdHJldHVybiBgWyR7ZGF0YS5uYW1lLnRvU3RyaW5nKCkudG9VcHBlckNhc2UoKX1dYFxuXHR9XG5cblx0cHJvdGVjdGVkIF9sb2cobmFtZTogc3RyaW5nLCBhcmd2LCBmYWlsQmFjayA9ICdsb2cnKVxuXHR7XG5cdFx0aWYgKCF0aGlzLmVuYWJsZWQpXG5cdFx0e1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdC8vIEB0cy1pZ25vcmVcblx0XHRsZXQgcyA9IHRoaXMuX2xvZ0Zvcm1hdCguLi5hcmd2KTtcblx0XHRsZXQgbyA9IHRoaXNbU1lNX0NIQUxLXShzKTtcblxuXHRcdGxldCBhcnIgPSBbXTtcblxuXHRcdGxldCBkYXRhID0gdGhpc1tTWU1fREFUQV07XG5cblx0XHRpZiAoZGF0YS50aW1lKVxuXHRcdHtcblx0XHRcdGxldCByZXQgPSB0aGlzLl90aW1lKHtcblx0XHRcdFx0bmFtZSxcblx0XHRcdFx0YXJndixcblx0XHRcdFx0ZmFpbEJhY2ssXG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKHJldCAhPSBudWxsKVxuXHRcdFx0e1xuXHRcdFx0XHRhcnIucHVzaChyZXQpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChkYXRhLmxhYmVsKVxuXHRcdHtcblx0XHRcdGxldCBfb2sgPSB0cnVlO1xuXG5cdFx0XHRpZiAoQXJyYXkuaXNBcnJheShkYXRhLmxhYmVsKSAmJiAhZGF0YS5sYWJlbC5pbmNsdWRlcyhuYW1lKSlcblx0XHRcdHtcblx0XHRcdFx0X29rID0gZmFsc2U7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfb2spXG5cdFx0XHR7XG5cdFx0XHRcdGxldCByZXQgPSB0aGlzLl9sYWJlbEZvcm1hdCh7XG5cdFx0XHRcdFx0bmFtZSxcblx0XHRcdFx0XHRhcmd2LFxuXHRcdFx0XHRcdGZhaWxCYWNrLFxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRpZiAocmV0ICE9IG51bGwpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRhcnIucHVzaChyZXQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0YXJyLnB1c2gobyk7XG5cblx0XHRpZiAoYXJyLmxlbmd0aCAmJiBkYXRhLmNvbG9ycyAmJiBkYXRhLmNvbG9yc1tuYW1lXSlcblx0XHR7XG5cdFx0XHRsZXQgYzogYW55ID0gZGF0YS5jb2xvcnNbbmFtZV07XG5cblx0XHRcdGlmICh0eXBlb2YgYyA9PT0gJ3N0cmluZycpXG5cdFx0XHR7XG5cdFx0XHRcdGMgPSBjaGFsa1tjXTtcblx0XHRcdH1cblxuXHRcdFx0YXJyID0gYXJyLm1hcCh2ID0+IGModikpO1xuXHRcdH1cblxuXHRcdGlmIChwcm9jZXNzLnBsYXRmb3JtID09ICd3aW4zMicgJiYgdGhpcy5lbmFibGVkQ29sb3IpXG5cdFx0e1xuXHRcdFx0LyoqXG5cdFx0XHQgKiBARklYTUUgZml4IGJ1ZyBvbiB3aW5kb3dzIHdoZW4gYWZ0ZXIgYm9sZFxuXHRcdFx0ICpcblx0XHRcdCAqIGh0dHBzOi8vZ2l0aHViLmNvbS9jaGFsay9jaGFsay9pc3N1ZXMvMTQ1I2lzc3VlY29tbWVudC0yODg5ODU5MDNcblx0XHRcdCAqL1xuXHRcdFx0YXJyID0gYXJyLm1hcCh2ID0+ICdcXHUwMDFCWzBtJyArIHYgKyAnXFx1MDAxQlswbScpO1xuXHRcdH1cblxuXHRcdGlmICghKG5hbWUgaW4gdGhpc1tTWU1fQ09OU09MRV0pKVxuXHRcdHtcblx0XHRcdG5hbWUgPSBmYWlsQmFjaztcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpc1tTWU1fQ09OU09MRV1bbmFtZV0oLi4uYXJyKTtcblx0fVxuXG5cdHByb3RlY3RlZCBfY2hhbGtTdHlsZU1ldGhvZChuYW1lKVxuXHR7XG5cdFx0cmV0dXJuIGZ1bmN0aW9uIGNoYWxrU3R5bGVNZXRob2QoLi4uYXJndilcblx0XHR7XG5cdFx0XHRsZXQgbyA9IHRoaXMuX2Nsb25lKCk7XG5cblx0XHRcdG9bU1lNX0NIQUxLXSA9IHRoaXNbU1lNX0NIQUxLXVtuYW1lXSguLi5hcmd2KTtcblxuXHRcdFx0cmV0dXJuIG87XG5cdFx0fTtcblx0fVxuXG5cdHByb3RlY3RlZCBfdGltZShkYXRhPzogUGFyYW1ldGVyczxJT3B0aW9uc1tcImxhYmVsRm9ybWF0Rm5cIl0+WzBdKVxuXHR7XG5cdFx0aWYgKHRoaXNbU1lNX0RBVEFdLnRpbWVGb3JtYXRGbilcblx0XHR7XG5cdFx0XHRsZXQgZGF0YTI6IFBhcmFtZXRlcnM8SU9wdGlvbnNbXCJ0aW1lRm9ybWF0Rm5cIl0+WzBdID0ge1xuXHRcdFx0XHQuLi5kYXRhLFxuXHRcdFx0XHRmYWlsQmFja1RpbWVGb3JtYXQ6IHRoaXNbU1lNX0RBVEFdLnRpbWVGb3JtYXQgfHwgJ1tISDptbTpzcy5TU1NdJyxcblx0XHRcdFx0ZGF0ZTogRGF0ZVRpbWUubG9jYWwoKSxcblx0XHRcdH07XG5cblx0XHRcdHJldHVybiB0aGlzW1NZTV9EQVRBXS50aW1lRm9ybWF0Rm4oZGF0YTIpO1xuXHRcdH1cblxuXHRcdHJldHVybiBEYXRlVGltZS5sb2NhbCgpLnRvRm9ybWF0KHRoaXNbU1lNX0RBVEFdLnRpbWVGb3JtYXQgfHwgJ1tISDptbTpzcy5TU1NdJyk7XG5cdH1cbn1cblxudXRpbC5pbmhlcml0cyhDb25zb2xlMiwgRnVuY3Rpb24pO1xuXG4vLyBAdHMtaWdub3JlXG5Db25zb2xlMi5wcm90b3R5cGUuQ29uc29sZSA9IENvbnNvbGUyXG5cbnN0eWxlTmFtZXMuZm9yRWFjaChmdW5jdGlvbiAobmFtZSlcbntcblx0aWYgKHN0eWxlTmFtZXNGbi5pbmNsdWRlcyhuYW1lIGFzIGFueSkpXG5cdHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc29sZTIucHJvdG90eXBlLCBuYW1lLCB7XG5cdFx0XHRnZXQoKVxuXHRcdFx0e1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fY2hhbGtTdHlsZU1ldGhvZChuYW1lKTtcblx0XHRcdH0sXG5cdFx0fSk7XG5cdH1cblx0ZWxzZVxuXHR7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnNvbGUyLnByb3RvdHlwZSwgbmFtZSwge1xuXHRcdFx0Z2V0KClcblx0XHRcdHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2NoYWxrU3R5bGVQcm9wKG5hbWUpO1xuXHRcdFx0fSxcblx0XHR9KTtcblx0fVxufSk7XG5cbkZpbGxQcm9wZXJ0eS5tZXRob2RzLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpXG57XG5cdGlmIChuYW1lID09ICdkaXInKVxuXHR7XG5cdFx0Q29uc29sZTIucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24gY2hhbGtTdHlsZUxvZ090aGVycyhvYmplY3QsIG9wdGlvbnMpXG5cdFx0e1xuXHRcdFx0aWYgKCF0aGlzLmVuYWJsZWQpXG5cdFx0XHR7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFvcHRpb25zICYmIHRoaXNbU1lNX0RBVEFdLmluc3BlY3RPcHRpb25zKVxuXHRcdFx0e1xuXHRcdFx0XHRvcHRpb25zID0gdGhpc1tTWU1fREFUQV0uaW5zcGVjdE9wdGlvbnM7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChvcHRpb25zKVxuXHRcdFx0e1xuXHRcdFx0XHRyZXR1cm4gdGhpc1tTWU1fQ09OU09MRV1bbmFtZV0ob2JqZWN0LCBvcHRpb25zKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHRoaXNbU1lNX0NPTlNPTEVdW25hbWVdKG9iamVjdCk7XG5cdFx0fTtcblx0fVxuXHRlbHNlIGlmIChuYW1lID09ICdhc3NlcnQnKVxuXHR7XG5cdFx0Q29uc29sZTIucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24gY2hhbGtTdHlsZUxvZ0Fzc2VydCh2YWx1ZSwgLi4uYXJndilcblx0XHR7XG5cdFx0XHRpZiAoIXRoaXMuZW5hYmxlZClcblx0XHRcdHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXZhbHVlKVxuXHRcdFx0e1xuXHRcdFx0XHRsZXQgbztcblx0XHRcdFx0aWYgKGFyZ3YubGVuZ3RoKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0bGV0IHMgPSB0aGlzLl9sb2dGb3JtYXQoLi4uYXJndik7XG5cblx0XHRcdFx0XHRvID0gdGhpc1tTWU1fQ0hBTEtdKHMpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiB0aGlzW1NZTV9DT05TT0xFXVtuYW1lXSh2YWx1ZSwgbyk7XG5cdFx0XHR9XG5cdFx0fTtcblx0fVxuXHRlbHNlIGlmIChGaWxsUHJvcGVydHkubWV0aG9kc19zdGRvdXQuaW5jbHVkZXMobmFtZSBhcyBhbnkpKVxuXHR7XG5cdFx0Q29uc29sZTIucHJvdG90eXBlW25hbWUgYXMgYW55XSA9IGZ1bmN0aW9uIGNoYWxrU3R5bGVMb2coLi4uYXJndilcblx0XHR7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbG9nKG5hbWUsIGFyZ3YpXG5cdFx0fTtcblx0fVxuXHRlbHNlIGlmIChGaWxsUHJvcGVydHkubWV0aG9kc19zdGRlcnIuaW5jbHVkZXMobmFtZSBhcyBhbnkpKVxuXHR7XG5cdFx0Q29uc29sZTIucHJvdG90eXBlW25hbWUgYXMgYW55XSA9IGZ1bmN0aW9uIGNoYWxrU3R5bGVMb2coLi4uYXJndilcblx0XHR7XG5cdFx0XHRyZXR1cm4gdGhpcy5fbG9nKG5hbWUsIGFyZ3YsICdlcnJvcicpXG5cdFx0fTtcblx0fVxuXHRlbHNlXG5cdHtcblx0XHRDb25zb2xlMi5wcm90b3R5cGVbbmFtZSBhcyBhbnldID0gZnVuY3Rpb24gY2hhbGtTdHlsZUxvZ090aGVycyguLi5hcmd2KVxuXHRcdHtcblx0XHRcdGlmICghdGhpcy5lbmFibGVkKVxuXHRcdFx0e1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB0aGlzW1NZTV9DT05TT0xFXVtuYW1lIGFzIGFueV0oLi4uYXJndik7XG5cdFx0fTtcblx0fVxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IENvbnNvbGUyXG4iXX0=