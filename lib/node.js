"use strict";
/**
 * Created by user on 2018/7/2/002.
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
/// <reference types="node" />
const chalk_1 = __importDefault(require("chalk"));
const luxon_1 = require("luxon");
const util_1 = require("util");
const chk_1 = __importDefault(require("./chk"));
const fill_property_1 = require("./fill-property");
const styles_1 = require("./styles");
const val_1 = require("./val");
const util_2 = require("./util");
class Console2 {
    constructor(target = console, options) {
        this[val_1.SYM_CONSOLE] = target || console;
        if (options && options.chalkOptions) {
            this[val_1.SYM_CHALK] = chalk_1.default.constructor(options.chalkOptions);
        }
        else {
            this[val_1.SYM_CHALK] = chalk_1.default.constructor();
        }
        // @ts-ignore
        this[val_1.SYM_DATA] = Object.create({
            colors: Object.create(val_1.defaultColors),
        });
        // @ts-ignore
        this[val_1.SYM_DATA].stream = null;
        if (this[val_1.SYM_CONSOLE] instanceof Console2) {
            let target = this[val_1.SYM_CONSOLE].getStream();
            if (target) {
                // @ts-ignore
                this[val_1.SYM_DATA].stream = util_2.hasConsoleStream(target);
            }
            else {
                // @ts-ignore
                this[val_1.SYM_DATA].stream = false;
            }
        }
        else {
            // @ts-ignore
            this[val_1.SYM_DATA].stream = util_2.hasConsoleStream(this[val_1.SYM_CONSOLE]);
        }
        Object.assign(this[val_1.SYM_DATA], options || {});
        this[val_1.SYM_DATA].chalkOptions = this[val_1.SYM_DATA].chalkOptions || {};
        if (this[val_1.SYM_DATA].chalkOptions.enabled) {
            this[val_1.SYM_CHALK].enabled = true;
        }
        else if (this[val_1.SYM_CHALK].enabled && !chk_1.default()) {
            this[val_1.SYM_CHALK].enabled = false;
        }
        else if (!this[val_1.SYM_CHALK].enabled && util_2.isForceColor()) {
            this[val_1.SYM_CHALK].enabled = true;
        }
        if (this[val_1.SYM_DATA].inspectOptions && this[val_1.SYM_DATA].inspectOptions.depth < 0) {
            this[val_1.SYM_DATA].inspectOptions.depth = null;
        }
    }
    get _stdout() {
        return this.getStream()._stdout;
    }
    get _stderr() {
        return this.getStream()._stderr;
    }
    getStream() {
        if (this[val_1.SYM_DATA].stream) {
            let _stdout;
            let _stderr;
            if (this[val_1.SYM_CONSOLE] instanceof Console2) {
                return this[val_1.SYM_CONSOLE].getStream();
            }
            else {
                // @ts-ignore
                ({ _stdout, _stderr } = this[val_1.SYM_CONSOLE]);
            }
            return {
                _stdout,
                _stderr,
            };
        }
        return null;
    }
    get chalk() {
        return this[val_1.SYM_CHALK];
    }
    set chalk(value) {
        this[val_1.SYM_CHALK] = value;
    }
    get levelColor() {
        return this[val_1.SYM_CHALK].level;
    }
    set levelColor(value) {
        this[val_1.SYM_CHALK].level = value;
    }
    get enabledColor() {
        return this[val_1.SYM_CHALK].enabled;
    }
    set enabledColor(value) {
        this[val_1.SYM_CHALK].enabled = value;
    }
    get chalkOptions() {
        return this[val_1.SYM_DATA].chalkOptions;
    }
    set chalkOptions(value) {
        this[val_1.SYM_DATA].chalkOptions = value;
    }
    get inspectOptions() {
        return this[val_1.SYM_DATA].inspectOptions;
    }
    set inspectOptions(value) {
        this[val_1.SYM_DATA].inspectOptions = value;
    }
    setInspectOptions(value) {
        this[val_1.SYM_DATA].inspectOptions = Object.assign(this[val_1.SYM_DATA].inspectOptions || {}, value);
    }
    get enabled() {
        return this[val_1.SYM_DATA].enabled !== false;
    }
    set enabled(value) {
        this[val_1.SYM_DATA].enabled = value === true;
    }
    setOptions(options) {
        Object.assign(this[val_1.SYM_DATA], options);
        return this;
    }
    withOptions(options) {
        let o = this._clone();
        o[val_1.SYM_CHALK] = this[val_1.SYM_CHALK];
        o[val_1.SYM_DATA] = Object.assign({}, this[val_1.SYM_DATA], options);
        return o;
    }
    _clone() {
        const self = this;
        let o = function Console2Method(...argv) {
            // @ts-ignore
            return o.log(...argv);
        };
        /**
         * allow hacking parent object
         */
        // @ts-ignore
        //o.__proto__ = this.__proto__.constructor.prototype;
        o.__proto__ = this;
        //o = o.bind(o);
        o[val_1.SYM_CONSOLE] = self[val_1.SYM_CONSOLE];
        o[val_1.SYM_DATA] = self[val_1.SYM_DATA];
        // @ts-ignore
        return o;
    }
    _chalkStyleProp(name) {
        let o = this._clone();
        o[val_1.SYM_CHALK] = this[val_1.SYM_CHALK][name];
        return o;
    }
    _logFormat(format, ...args) {
        return util_1.format(format, ...args);
    }
    success(...argv) {
        return this._log('success', argv);
    }
    ok(...argv) {
        return this._log('ok', argv);
    }
    fail(...argv) {
        return this._log('fail', argv, 'error');
    }
    _labelFormat(data) {
        if (this[val_1.SYM_DATA].labelFormatFn) {
            return this[val_1.SYM_DATA].labelFormatFn(data);
        }
        return `[${data.name.toString().toUpperCase()}]`;
    }
    _log(name, argv, failBack = 'log') {
        if (!this.enabled) {
            return;
        }
        // @ts-ignore
        let s = this._logFormat(...argv);
        let o = this[val_1.SYM_CHALK](s);
        let arr = [];
        let data = this[val_1.SYM_DATA];
        if (data.time) {
            let ret = this._time({
                name,
                argv,
                failBack,
            });
            if (ret != null) {
                arr.push(ret);
            }
        }
        if (data.label) {
            let _ok = true;
            if (Array.isArray(data.label) && !data.label.includes(name)) {
                _ok = false;
            }
            if (_ok) {
                let ret = this._labelFormat({
                    name,
                    argv,
                    failBack,
                });
                if (ret != null) {
                    arr.push(ret);
                }
            }
        }
        arr.push(o);
        if (arr.length && data.colors && data.colors[name]) {
            let c = data.colors[name];
            if (typeof c === 'string') {
                c = chalk_1.default[c];
            }
            arr = arr.map(v => c(v));
        }
        if (process.platform == 'win32' && this.enabledColor) {
            /**
             * @FIXME fix bug on windows when after bold
             *
             * https://github.com/chalk/chalk/issues/145#issuecomment-288985903
             */
            arr = arr.map(v => '\u001B[0m' + v + '\u001B[0m');
        }
        if (!(name in this[val_1.SYM_CONSOLE])) {
            name = failBack;
        }
        return this[val_1.SYM_CONSOLE][name](...arr);
    }
    _chalkStyleMethod(name) {
        return function chalkStyleMethod(...argv) {
            let o = this._clone();
            o[val_1.SYM_CHALK] = this[val_1.SYM_CHALK][name](...argv);
            return o;
        };
    }
    _time(data) {
        if (this[val_1.SYM_DATA].timeFormatFn) {
            let data2 = {
                ...data,
                failBackTimeFormat: this[val_1.SYM_DATA].timeFormat || '[HH:mm:ss.SSS]',
                date: luxon_1.DateTime.local(),
            };
            return this[val_1.SYM_DATA].timeFormatFn(data2);
        }
        return luxon_1.DateTime.local().toFormat(this[val_1.SYM_DATA].timeFormat || '[HH:mm:ss.SSS]');
    }
}
exports.Console2 = Console2;
util_1.inherits(Console2, Function);
// @ts-ignore
Console2.prototype.Console = Console2;
styles_1.styleNames.forEach(function (name) {
    if (styles_1.styleNamesFn.includes(name)) {
        Object.defineProperty(Console2.prototype, name, {
            get() {
                return this._chalkStyleMethod(name);
            },
        });
    }
    else {
        Object.defineProperty(Console2.prototype, name, {
            get() {
                return this._chalkStyleProp(name);
            },
        });
    }
});
fill_property_1.methods.forEach(function (name) {
    if (name == 'dir') {
        Console2.prototype[name] = function chalkStyleLogOthers(object, options) {
            if (!this.enabled) {
                return;
            }
            let enabledColor = this.enabledColor;
            if (!options && this[val_1.SYM_DATA].inspectOptions) {
                options = this[val_1.SYM_DATA].inspectOptions;
            }
            if (options) {
                if (enabledColor && options.colors == null) {
                    options = {
                        ...options,
                        colors: enabledColor
                    };
                }
                return this[val_1.SYM_CONSOLE][name](object, options);
            }
            return this[val_1.SYM_CONSOLE][name](object, {
                colors: enabledColor,
            });
        };
    }
    else if (name == 'assert') {
        Console2.prototype[name] = function chalkStyleLogAssert(value, ...argv) {
            if (!this.enabled) {
                return;
            }
            if (!value) {
                let o;
                if (argv.length) {
                    // @ts-ignore
                    let s = this._logFormat(...argv);
                    o = this[val_1.SYM_CHALK](s);
                }
                return this[val_1.SYM_CONSOLE][name](value, o);
            }
        };
    }
    else if (fill_property_1.methods_stdout.includes(name)) {
        Console2.prototype[name] = function chalkStyleLogStdout(...argv) {
            // @ts-ignore
            return this._log(name, argv);
        };
    }
    else if (fill_property_1.methods_stderr.includes(name)) {
        Console2.prototype[name] = function chalkStyleLogStderr(...argv) {
            // @ts-ignore
            return this._log(name, argv, 'error');
        };
    }
    else {
        Console2.prototype[name] = function chalkStyleLogOthers(...argv) {
            if (!this.enabled) {
                return;
            }
            return this[val_1.SYM_CONSOLE][name](...argv);
        };
    }
});
exports.default = Console2;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9kZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm5vZGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOzs7OztBQUVILDhCQUE4QjtBQUU5QixrREFBMEQ7QUFFMUQsaUNBQWlDO0FBQ2pDLCtCQUFzRTtBQUN0RSxnREFBNkI7QUFDN0IsbURBQTBFO0FBQzFFLHFDQUE2RDtBQUM3RCwrQkFBa0c7QUFDbEcsaUNBQXdEO0FBb0h4RCxNQUFhLFFBQVE7SUFFcEIsWUFBWSxTQUFpRCxPQUFPLEVBQUUsT0FBa0I7UUFFdkYsSUFBSSxDQUFDLGlCQUFXLENBQUMsR0FBRyxNQUFNLElBQUksT0FBTyxDQUFDO1FBRXRDLElBQUksT0FBTyxJQUFJLE9BQU8sQ0FBQyxZQUFZLEVBQ25DO1lBQ0MsSUFBSSxDQUFDLGVBQVMsQ0FBQyxHQUFHLGVBQUssQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQzFEO2FBRUQ7WUFDQyxJQUFJLENBQUMsZUFBUyxDQUFDLEdBQUcsZUFBSyxDQUFDLFdBQVcsRUFBRSxDQUFDO1NBQ3RDO1FBRUQsYUFBYTtRQUNiLElBQUksQ0FBQyxjQUFRLENBQUMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDO1lBQzlCLE1BQU0sRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLG1CQUFhLENBQUM7U0FFcEMsQ0FBQyxDQUFDO1FBRUgsYUFBYTtRQUNiLElBQUksQ0FBQyxjQUFRLENBQUMsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1FBRTdCLElBQUksSUFBSSxDQUFDLGlCQUFXLENBQUMsWUFBWSxRQUFRLEVBQ3pDO1lBQ0MsSUFBSSxNQUFNLEdBQUksSUFBSSxDQUFDLGlCQUFXLENBQWMsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUV6RCxJQUFJLE1BQU0sRUFDVjtnQkFDQyxhQUFhO2dCQUNiLElBQUksQ0FBQyxjQUFRLENBQUMsQ0FBQyxNQUFNLEdBQUcsdUJBQWdCLENBQUMsTUFBTSxDQUFD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WUFDYixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFBO1FBQzdCLENBQUMsQ0FBQztLQUNGO1NBQ0ksSUFBSSw4QkFBYyxDQUFDLFFBQVEsQ0FBQyxJQUFXLENBQUMsRUFDN0M7UUFDQyxRQUFRLENBQUMsU0FBUyxDQUFDLElBQVcsQ0FBQyxHQUFHLFNBQVMsbUJBQW1CLENBQUMsR0FBRyxJQUFJO1lBRXJFLGFBQWE7WUFDYixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQTtRQUN0QyxDQUFDLENBQUM7S0FDRjtTQUVEO1FBQ0MsUUFBUSxDQUFDLFNBQVMsQ0FBQyxJQUFXLENBQUMsR0FBRyxTQUFTLG1CQUFtQixDQUFDLEdBQUcsSUFBSTtZQUVyRSxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFDakI7Z0JBQ0MsT0FBTzthQUNQO1lBRUQsT0FBTyxJQUFJLENBQUMsaUJBQVcsQ0FBQyxDQUFDLElBQVcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFDaEQsQ0FBQyxDQUFDO0tBQ0Y7QUFDRixDQUFDLENBQUMsQ0FBQztBQUVILGtCQUFlLFFBQVEsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSB1c2VyIG9uIDIwMTgvNy8yLzAwMi5cbiAqL1xuXG4vLy8gPHJlZmVyZW5jZSB0eXBlcz1cIm5vZGVcIiAvPlxuXG5pbXBvcnQgY2hhbGssIHsgQ2hhbGssIExldmVsLCBDaGFsa09wdGlvbnMgfSBmcm9tICdjaGFsayc7XG5pbXBvcnQgeyBDb25zb2xlIH0gZnJvbSAnY29uc29sZSc7XG5pbXBvcnQgeyBEYXRlVGltZSB9IGZyb20gJ2x1eG9uJztcbmltcG9ydCB7IGZvcm1hdCBhcyB1dGlsRm9ybWF0LCBpbmhlcml0cyBhcyB1dGlsSW5oZXJpdHMgfSBmcm9tICd1dGlsJztcbmltcG9ydCBpc05vZGVKcyBmcm9tICcuL2Noayc7XG5pbXBvcnQgeyBtZXRob2RzX3N0ZG91dCwgbWV0aG9kc19zdGRlcnIsIG1ldGhvZHMgfSBmcm9tICcuL2ZpbGwtcHJvcGVydHknO1xuaW1wb3J0IHsgSVN0eWxlcywgc3R5bGVOYW1lcywgc3R5bGVOYW1lc0ZuIH0gZnJvbSAnLi9zdHlsZXMnO1xuaW1wb3J0IHsgZGVmYXVsdENvbG9ycywgSU9wdGlvbnMsIFNZTV9DSEFMSywgU1lNX0NPTlNPTEUsIFNZTV9EQVRBLCBJbnNwZWN0T3B0aW9ucyB9IGZyb20gJy4vdmFsJztcbmltcG9ydCB7IGhhc0NvbnNvbGVTdHJlYW0sIGlzRm9yY2VDb2xvciB9IGZyb20gJy4vdXRpbCc7XG5pbXBvcnQgV3JpdGVTdHJlYW0gPSBOb2RlSlMuV3JpdGVTdHJlYW07XG5cbmV4cG9ydCB0eXBlIElDb25zb2xlV2l0aFN0cmVhbTxUIGV4dGVuZHMgb2JqZWN0ID0gQ29uc29sZT4gPSBUICYge1xuXHRfc3Rkb3V0PzogV3JpdGVTdHJlYW07XG5cdF9zdGRlcnI/OiBXcml0ZVN0cmVhbTtcbn1cblxuZXhwb3J0IHsgSW5zcGVjdE9wdGlvbnMgfTtcblxuZXhwb3J0IGludGVyZmFjZSBDb25zb2xlMiBleHRlbmRzIElDb25zb2xlV2l0aFN0cmVhbTxDb25zb2xlPiwgSVN0eWxlc1xue1xuXHQoLi4uYXJndik6IHZvaWRcblxuXHRbU1lNX0NPTlNPTEVdOiBJQ29uc29sZVdpdGhTdHJlYW08Q29uc29sZT4gfCBDb25zb2xlMjtcblx0W1NZTV9DSEFMS106IENoYWxrO1xuXG5cdFtTWU1fREFUQV06IElPcHRpb25zXG5cblx0LyoqXG5cdCAqIEEgc2ltcGxlIGFzc2VydGlvbiB0ZXN0IHRoYXQgdmVyaWZpZXMgd2hldGhlciBgdmFsdWVgIGlzIHRydXRoeS5cblx0ICogSWYgaXQgaXMgbm90LCBhbiBgQXNzZXJ0aW9uRXJyb3JgIGlzIHRocm93bi5cblx0ICogSWYgcHJvdmlkZWQsIHRoZSBlcnJvciBgbWVzc2FnZWAgaXMgZm9ybWF0dGVkIHVzaW5nIGB1dGlsLmZvcm1hdCgpYCBhbmQgdXNlZCBhcyB0aGUgZXJyb3IgbWVzc2FnZS5cblx0ICovXG5cdGFzc2VydCh2YWx1ZTogYW55LCBtZXNzYWdlPzogc3RyaW5nLCAuLi5vcHRpb25hbFBhcmFtczogYW55W10pOiB2b2lkO1xuXHQvKipcblx0ICogV2hlbiBgc3Rkb3V0YCBpcyBhIFRUWSwgY2FsbGluZyBgY29uc29sZS5jbGVhcigpYCB3aWxsIGF0dGVtcHQgdG8gY2xlYXIgdGhlIFRUWS5cblx0ICogV2hlbiBgc3Rkb3V0YCBpcyBub3QgYSBUVFksIHRoaXMgbWV0aG9kIGRvZXMgbm90aGluZy5cblx0ICovXG5cdGNsZWFyKCk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBNYWludGFpbnMgYW4gaW50ZXJuYWwgY291bnRlciBzcGVjaWZpYyB0byBgbGFiZWxgIGFuZCBvdXRwdXRzIHRvIGBzdGRvdXRgIHRoZSBudW1iZXIgb2YgdGltZXMgYGNvbnNvbGUuY291bnQoKWAgaGFzIGJlZW4gY2FsbGVkIHdpdGggdGhlIGdpdmVuIGBsYWJlbGAuXG5cdCAqL1xuXHRjb3VudChsYWJlbD86IHN0cmluZyk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBSZXNldHMgdGhlIGludGVybmFsIGNvdW50ZXIgc3BlY2lmaWMgdG8gYGxhYmVsYC5cblx0ICovXG5cdGNvdW50UmVzZXQobGFiZWw/OiBzdHJpbmcpOiB2b2lkO1xuXHQvKipcblx0ICogVGhlIGBjb25zb2xlLmRlYnVnKClgIGZ1bmN0aW9uIGlzIGFuIGFsaWFzIGZvciB7QGxpbmsgY29uc29sZS5sb2coKX0uXG5cdCAqL1xuXHRkZWJ1ZyhtZXNzYWdlPzogYW55LCAuLi5vcHRpb25hbFBhcmFtczogYW55W10pOiB2b2lkO1xuXHQvKipcblx0ICogVXNlcyB7QGxpbmsgdXRpbC5pbnNwZWN0KCl9IG9uIGBvYmpgIGFuZCBwcmludHMgdGhlIHJlc3VsdGluZyBzdHJpbmcgdG8gYHN0ZG91dGAuXG5cdCAqIFRoaXMgZnVuY3Rpb24gYnlwYXNzZXMgYW55IGN1c3RvbSBgaW5zcGVjdCgpYCBmdW5jdGlvbiBkZWZpbmVkIG9uIGBvYmpgLlxuXHQgKi9cblx0ZGlyKG9iajogYW55LCBvcHRpb25zPzogTm9kZUpTLkluc3BlY3RPcHRpb25zKTogdm9pZDtcblx0LyoqXG5cdCAqIFRoaXMgbWV0aG9kIGNhbGxzIHtAbGluayBjb25zb2xlLmxvZygpfSBwYXNzaW5nIGl0IHRoZSBhcmd1bWVudHMgcmVjZWl2ZWQuIFBsZWFzZSBub3RlIHRoYXQgdGhpcyBtZXRob2QgZG9lcyBub3QgcHJvZHVjZSBhbnkgWE1MIGZvcm1hdHRpbmdcblx0ICovXG5cdGRpcnhtbCguLi5kYXRhOiBhbnlbXSk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBQcmludHMgdG8gYHN0ZGVycmAgd2l0aCBuZXdsaW5lLlxuXHQgKi9cblx0ZXJyb3IobWVzc2FnZT86IGFueSwgLi4ub3B0aW9uYWxQYXJhbXM6IGFueVtdKTogdm9pZDtcblx0LyoqXG5cdCAqIEluY3JlYXNlcyBpbmRlbnRhdGlvbiBvZiBzdWJzZXF1ZW50IGxpbmVzIGJ5IHR3byBzcGFjZXMuXG5cdCAqIElmIG9uZSBvciBtb3JlIGBsYWJlbGBzIGFyZSBwcm92aWRlZCwgdGhvc2UgYXJlIHByaW50ZWQgZmlyc3Qgd2l0aG91dCB0aGUgYWRkaXRpb25hbCBpbmRlbnRhdGlvbi5cblx0ICovXG5cdGdyb3VwKC4uLmxhYmVsOiBhbnlbXSk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBUaGUgYGNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQoKWAgZnVuY3Rpb24gaXMgYW4gYWxpYXMgZm9yIHtAbGluayBjb25zb2xlLmdyb3VwKCl9LlxuXHQgKi9cblx0Z3JvdXBDb2xsYXBzZWQoKTogdm9pZDtcblx0LyoqXG5cdCAqIERlY3JlYXNlcyBpbmRlbnRhdGlvbiBvZiBzdWJzZXF1ZW50IGxpbmVzIGJ5IHR3byBzcGFjZXMuXG5cdCAqL1xuXHRncm91cEVuZCgpOiB2b2lkO1xuXHQvKipcblx0ICogVGhlIHtAbGluayBjb25zb2xlLmluZm8oKX0gZnVuY3Rpb24gaXMgYW4gYWxpYXMgZm9yIHtAbGluayBjb25zb2xlLmxvZygpfS5cblx0ICovXG5cdGluZm8obWVzc2FnZT86IGFueSwgLi4ub3B0aW9uYWxQYXJhbXM6IGFueVtdKTogdm9pZDtcblx0LyoqXG5cdCAqIFByaW50cyB0byBgc3Rkb3V0YCB3aXRoIG5ld2xpbmUuXG5cdCAqL1xuXHRsb2cobWVzc2FnZT86IGFueSwgLi4ub3B0aW9uYWxQYXJhbXM6IGFueVtdKTogdm9pZDtcblx0LyoqXG5cdCAqIFRoaXMgbWV0aG9kIGRvZXMgbm90IGRpc3BsYXkgYW55dGhpbmcgdW5sZXNzIHVzZWQgaW4gdGhlIGluc3BlY3Rvci5cblx0ICogIFByaW50cyB0byBgc3Rkb3V0YCB0aGUgYXJyYXkgYGFycmF5YCBmb3JtYXR0ZWQgYXMgYSB0YWJsZS5cblx0ICovXG5cdHRhYmxlKHRhYnVsYXJEYXRhOiBhbnksIHByb3BlcnRpZXM/OiBzdHJpbmdbXSk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBTdGFydHMgYSB0aW1lciB0aGF0IGNhbiBiZSB1c2VkIHRvIGNvbXB1dGUgdGhlIGR1cmF0aW9uIG9mIGFuIG9wZXJhdGlvbi4gVGltZXJzIGFyZSBpZGVudGlmaWVkIGJ5IGEgdW5pcXVlIGBsYWJlbGAuXG5cdCAqL1xuXHR0aW1lKGxhYmVsPzogc3RyaW5nKTogdm9pZDtcblx0LyoqXG5cdCAqIFN0b3BzIGEgdGltZXIgdGhhdCB3YXMgcHJldmlvdXNseSBzdGFydGVkIGJ5IGNhbGxpbmcge0BsaW5rIGNvbnNvbGUudGltZSgpfSBhbmQgcHJpbnRzIHRoZSByZXN1bHQgdG8gYHN0ZG91dGAuXG5cdCAqL1xuXHR0aW1lRW5kKGxhYmVsPzogc3RyaW5nKTogdm9pZDtcblx0LyoqXG5cdCAqIFByaW50cyB0byBgc3RkZXJyYCB0aGUgc3RyaW5nICdUcmFjZSA6JywgZm9sbG93ZWQgYnkgdGhlIHtAbGluayB1dGlsLmZvcm1hdCgpfSBmb3JtYXR0ZWQgbWVzc2FnZSBhbmQgc3RhY2sgdHJhY2UgdG8gdGhlIGN1cnJlbnQgcG9zaXRpb24gaW4gdGhlIGNvZGUuXG5cdCAqL1xuXHR0cmFjZShtZXNzYWdlPzogYW55LCAuLi5vcHRpb25hbFBhcmFtczogYW55W10pOiB2b2lkO1xuXHQvKipcblx0ICogVGhlIHtAbGluayBjb25zb2xlLndhcm4oKX0gZnVuY3Rpb24gaXMgYW4gYWxpYXMgZm9yIHtAbGluayBjb25zb2xlLmVycm9yKCl9LlxuXHQgKi9cblx0d2FybihtZXNzYWdlPzogYW55LCAuLi5vcHRpb25hbFBhcmFtczogYW55W10pOiB2b2lkO1xuXG5cdC8vIC0tLSBJbnNwZWN0b3IgbW9kZSBvbmx5IC0tLVxuXHQvKipcblx0ICogVGhpcyBtZXRob2QgZG9lcyBub3QgZGlzcGxheSBhbnl0aGluZyB1bmxlc3MgdXNlZCBpbiB0aGUgaW5zcGVjdG9yLlxuXHQgKiAgU3RhcnRzIGEgSmF2YVNjcmlwdCBDUFUgcHJvZmlsZSB3aXRoIGFuIG9wdGlvbmFsIGxhYmVsLlxuXHQgKi9cblx0cHJvZmlsZShsYWJlbD86IHN0cmluZyk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBUaGlzIG1ldGhvZCBkb2VzIG5vdCBkaXNwbGF5IGFueXRoaW5nIHVubGVzcyB1c2VkIGluIHRoZSBpbnNwZWN0b3IuXG5cdCAqICBTdG9wcyB0aGUgY3VycmVudCBKYXZhU2NyaXB0IENQVSBwcm9maWxpbmcgc2Vzc2lvbiBpZiBvbmUgaGFzIGJlZW4gc3RhcnRlZCBhbmQgcHJpbnRzIHRoZSByZXBvcnQgdG8gdGhlIFByb2ZpbGVzIHBhbmVsIG9mIHRoZSBpbnNwZWN0b3IuXG5cdCAqL1xuXHRwcm9maWxlRW5kKCk6IHZvaWQ7XG5cdC8qKlxuXHQgKiBUaGlzIG1ldGhvZCBkb2VzIG5vdCBkaXNwbGF5IGFueXRoaW5nIHVubGVzcyB1c2VkIGluIHRoZSBpbnNwZWN0b3IuXG5cdCAqICBBZGRzIGFuIGV2ZW50IHdpdGggdGhlIGxhYmVsIGBsYWJlbGAgdG8gdGhlIFRpbWVsaW5lIHBhbmVsIG9mIHRoZSBpbnNwZWN0b3IuXG5cdCAqL1xuXHR0aW1lU3RhbXAobGFiZWw/OiBzdHJpbmcpOiB2b2lkO1xufVxuXG5leHBvcnQgY2xhc3MgQ29uc29sZTJcbntcblx0Y29uc3RydWN0b3IodGFyZ2V0OiBDb25zb2xlMiB8IElDb25zb2xlV2l0aFN0cmVhbTxDb25zb2xlPiA9IGNvbnNvbGUsIG9wdGlvbnM/OiBJT3B0aW9ucylcblx0e1xuXHRcdHRoaXNbU1lNX0NPTlNPTEVdID0gdGFyZ2V0IHx8IGNvbnNvbGU7XG5cblx0XHRpZiAob3B0aW9ucyAmJiBvcHRpb25zLmNoYWxrT3B0aW9ucylcblx0XHR7XG5cdFx0XHR0aGlzW1NZTV9DSEFMS10gPSBjaGFsay5jb25zdHJ1Y3RvcihvcHRpb25zLmNoYWxrT3B0aW9ucyk7XG5cdFx0fVxuXHRcdGVsc2Vcblx0XHR7XG5cdFx0XHR0aGlzW1NZTV9DSEFMS10gPSBjaGFsay5jb25zdHJ1Y3RvcigpO1xuXHRcdH1cblxuXHRcdC8vIEB0cy1pZ25vcmVcblx0XHR0aGlzW1NZTV9EQVRBXSA9IE9iamVjdC5jcmVhdGUoe1xuXHRcdFx0Y29sb3JzOiBPYmplY3QuY3JlYXRlKGRlZmF1bHRDb2xvcnMpLFxuXHRcdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdH0pO1xuXG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdHRoaXNbU1lNX0RBVEFdLnN0cmVhbSA9IG51bGw7XG5cblx0XHRpZiAodGhpc1tTWU1fQ09OU09MRV0gaW5zdGFuY2VvZiBDb25zb2xlMilcblx0XHR7XG5cdFx0XHRsZXQgdGFyZ2V0ID0gKHRoaXNbU1lNX0NPTlNPTEVdIGFzIENvbnNvbGUyKS5nZXRTdHJlYW0oKTtcblxuXHRcdFx0aWYgKHRhcmdldClcblx0XHRcdHtcblx0XHRcdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdFx0XHR0aGlzW1NZTV9EQVRBXS5zdHJlYW0gPSBoYXNDb25zb2xlU3RyZWFtKHRhcmdldCk7XG5cdFx0XHR9XG5cdFx0XHRlbHNlXG5cdFx0XHR7XG5cdFx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdFx0dGhpc1tTWU1fREFUQV0uc3RyZWFtID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGVsc2Vcblx0XHR7XG5cdFx0XHQvLyBAdHMtaWdub3JlXG5cdFx0XHR0aGlzW1NZTV9EQVRBXS5zdHJlYW0gPSBoYXNDb25zb2xlU3RyZWFtKHRoaXNbU1lNX0NPTlNPTEVdKTtcblx0XHR9XG5cblx0XHRPYmplY3QuYXNzaWduKHRoaXNbU1lNX0RBVEFdLCBvcHRpb25zIHx8IHt9KTtcblxuXHRcdHRoaXNbU1lNX0RBVEFdLmNoYWxrT3B0aW9ucyA9IHRoaXNbU1lNX0RBVEFdLmNoYWxrT3B0aW9ucyB8fCB7fTtcblxuXHRcdGlmICh0aGlzW1NZTV9EQVRBXS5jaGFsa09wdGlvbnMuZW5hYmxlZClcblx0XHR7XG5cdFx0XHR0aGlzW1NZTV9DSEFMS10uZW5hYmxlZCA9IHRydWU7XG5cdFx0fVxuXHRcdGVsc2UgaWYgKHRoaXNbU1lNX0NIQUxLXS5lbmFibGVkICYmICFpc05vZGVKcygpKVxuXHRcdHtcblx0XHRcdHRoaXNbU1lNX0NIQUxLXS5lbmFibGVkID0gZmFsc2U7XG5cdFx0fVxuXHRcdGVsc2UgaWYgKCF0aGlzW1NZTV9DSEFMS10uZW5hYmxlZCAmJiBpc0ZvcmNlQ29sb3IoKSlcblx0XHR7XG5cdFx0XHR0aGlzW1NZTV9DSEFMS10uZW5hYmxlZCA9IHRydWU7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXNbU1lNX0RBVEFdLmluc3BlY3RPcHRpb25zICYmIHRoaXNbU1lNX0RBVEFdLmluc3BlY3RPcHRpb25zLmRlcHRoIDwgMClcblx0XHR7XG5cdFx0XHR0aGlzW1NZTV9EQVRBXS5pbnNwZWN0T3B0aW9ucy5kZXB0aCA9IG51bGw7XG5cdFx0fVxuXHR9XG5cblx0Z2V0IF9zdGRvdXQoKVxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuZ2V0U3RyZWFtKCkuX3N0ZG91dFxuXHR9XG5cblx0Z2V0IF9zdGRlcnIoKVxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuZ2V0U3RyZWFtKCkuX3N0ZGVyclxuXHR9XG5cblx0Z2V0U3RyZWFtKCk6IHtcblx0XHRfc3Rkb3V0OiBXcml0ZVN0cmVhbTtcblx0XHRfc3RkZXJyOiBXcml0ZVN0cmVhbTtcblx0fVxuXHR7XG5cdFx0aWYgKHRoaXNbU1lNX0RBVEFdLnN0cmVhbSlcblx0XHR7XG5cdFx0XHRsZXQgX3N0ZG91dDogV3JpdGVTdHJlYW07XG5cdFx0XHRsZXQgX3N0ZGVycjogV3JpdGVTdHJlYW07XG5cblx0XHRcdGlmICh0aGlzW1NZTV9DT05TT0xFXSBpbnN0YW5jZW9mIENvbnNvbGUyKVxuXHRcdFx0e1xuXHRcdFx0XHRyZXR1cm4gKHRoaXNbU1lNX0NPTlNPTEVdIGFzIENvbnNvbGUyKS5nZXRTdHJlYW0oKVxuXHRcdFx0fVxuXHRcdFx0ZWxzZVxuXHRcdFx0e1xuXHRcdFx0XHQvLyBAdHMtaWdub3JlXG5cdFx0XHRcdCh7IF9zdGRvdXQsIF9zdGRlcnIgfSA9IHRoaXNbU1lNX0NPTlNPTEVdKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0X3N0ZG91dCxcblx0XHRcdFx0X3N0ZGVycixcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gbnVsbDtcblx0fVxuXG5cdGdldCBjaGFsaygpXG5cdHtcblx0XHRyZXR1cm4gdGhpc1tTWU1fQ0hBTEtdXG5cdH1cblxuXHRzZXQgY2hhbGsodmFsdWUpXG5cdHtcblx0XHR0aGlzW1NZTV9DSEFMS10gPSB2YWx1ZVxuXHR9XG5cblx0Z2V0IGxldmVsQ29sb3IoKTogTGV2ZWxcblx0e1xuXHRcdHJldHVybiB0aGlzW1NZTV9DSEFMS10ubGV2ZWxcblx0fVxuXG5cdHNldCBsZXZlbENvbG9yKHZhbHVlKVxuXHR7XG5cdFx0dGhpc1tTWU1fQ0hBTEtdLmxldmVsID0gdmFsdWVcblx0fVxuXG5cdGdldCBlbmFibGVkQ29sb3IoKVxuXHR7XG5cdFx0cmV0dXJuIHRoaXNbU1lNX0NIQUxLXS5lbmFibGVkXG5cdH1cblxuXHRzZXQgZW5hYmxlZENvbG9yKHZhbHVlKVxuXHR7XG5cdFx0dGhpc1tTWU1fQ0hBTEtdLmVuYWJsZWQgPSB2YWx1ZVxuXHR9XG5cblx0Z2V0IGNoYWxrT3B0aW9ucygpXG5cdHtcblx0XHRyZXR1cm4gdGhpc1tTWU1fREFUQV0uY2hhbGtPcHRpb25zXG5cdH1cblxuXHRzZXQgY2hhbGtPcHRpb25zKHZhbHVlKVxuXHR7XG5cdFx0dGhpc1tTWU1fREFUQV0uY2hhbGtPcHRpb25zID0gdmFsdWVcblx0fVxuXG5cdGdldCBpbnNwZWN0T3B0aW9ucygpXG5cdHtcblx0XHRyZXR1cm4gdGhpc1tTWU1fREFUQV0uaW5zcGVjdE9wdGlvbnNcblx0fVxuXG5cdHNldCBpbnNwZWN0T3B0aW9ucyh2YWx1ZSlcblx0e1xuXHRcdHRoaXNbU1lNX0RBVEFdLmluc3BlY3RPcHRpb25zID0gdmFsdWVcblx0fVxuXG5cdHNldEluc3BlY3RPcHRpb25zKHZhbHVlOiBJbnNwZWN0T3B0aW9ucylcblx0e1xuXHRcdHRoaXNbU1lNX0RBVEFdLmluc3BlY3RPcHRpb25zID0gT2JqZWN0LmFzc2lnbih0aGlzW1NZTV9EQVRBXS5pbnNwZWN0T3B0aW9ucyB8fCB7fSwgdmFsdWUpO1xuXHR9XG5cblx0Z2V0IGVuYWJsZWQoKVxuXHR7XG5cdFx0cmV0dXJuIHRoaXNbU1lNX0RBVEFdLmVuYWJsZWQgIT09IGZhbHNlXG5cdH1cblxuXHRzZXQgZW5hYmxlZCh2YWx1ZSlcblx0e1xuXHRcdHRoaXNbU1lNX0RBVEFdLmVuYWJsZWQgPSB2YWx1ZSA9PT0gdHJ1ZVxuXHR9XG5cblx0c2V0T3B0aW9ucyhvcHRpb25zOiBJT3B0aW9ucylcblx0e1xuXHRcdE9iamVjdC5hc3NpZ24odGhpc1tTWU1fREFUQV0sIG9wdGlvbnMpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHR3aXRoT3B0aW9ucyhvcHRpb25zOiBJT3B0aW9ucylcblx0e1xuXHRcdGxldCBvID0gdGhpcy5fY2xvbmUoKTtcblxuXHRcdG9bU1lNX0NIQUxLXSA9IHRoaXNbU1lNX0NIQUxLXTtcblxuXHRcdG9bU1lNX0RBVEFdID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpc1tTWU1fREFUQV0sIG9wdGlvbnMpO1xuXG5cdFx0cmV0dXJuIG87XG5cdH1cblxuXHRwcm90ZWN0ZWQgX2Nsb25lKCk6IHRoaXNcblx0e1xuXHRcdGNvbnN0IHNlbGYgPSB0aGlzO1xuXG5cdFx0bGV0IG8gPSBmdW5jdGlvbiBDb25zb2xlMk1ldGhvZCguLi5hcmd2KVxuXHRcdHtcblx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdHJldHVybiBvLmxvZyguLi5hcmd2KTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogYWxsb3cgaGFja2luZyBwYXJlbnQgb2JqZWN0XG5cdFx0ICovXG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdC8vby5fX3Byb3RvX18gPSB0aGlzLl9fcHJvdG9fXy5jb25zdHJ1Y3Rvci5wcm90b3R5cGU7XG5cdFx0by5fX3Byb3RvX18gPSB0aGlzO1xuXG5cdFx0Ly9vID0gby5iaW5kKG8pO1xuXG5cdFx0b1tTWU1fQ09OU09MRV0gPSBzZWxmW1NZTV9DT05TT0xFXTtcblx0XHRvW1NZTV9EQVRBXSA9IHNlbGZbU1lNX0RBVEFdO1xuXG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdHJldHVybiBvO1xuXHR9XG5cblx0cHJvdGVjdGVkIF9jaGFsa1N0eWxlUHJvcChuYW1lKVxuXHR7XG5cdFx0bGV0IG8gPSB0aGlzLl9jbG9uZSgpO1xuXHRcdG9bU1lNX0NIQUxLXSA9IHRoaXNbU1lNX0NIQUxLXVtuYW1lXTtcblx0XHRyZXR1cm4gbztcblx0fVxuXG5cdHByb3RlY3RlZCBfbG9nRm9ybWF0KGZvcm1hdCwgLi4uYXJncylcblx0e1xuXHRcdHJldHVybiB1dGlsRm9ybWF0KGZvcm1hdCwgLi4uYXJncyk7XG5cdH1cblxuXHRzdWNjZXNzKC4uLmFyZ3YpXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fbG9nKCdzdWNjZXNzJywgYXJndik7XG5cdH1cblxuXHRvayguLi5hcmd2KVxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX2xvZygnb2snLCBhcmd2KTtcblx0fVxuXG5cdGZhaWwoLi4uYXJndilcblx0e1xuXHRcdHJldHVybiB0aGlzLl9sb2coJ2ZhaWwnLCBhcmd2LCAnZXJyb3InKTtcblx0fVxuXG5cdHByb3RlY3RlZCBfbGFiZWxGb3JtYXQoZGF0YTogUGFyYW1ldGVyczxJT3B0aW9uc1tcImxhYmVsRm9ybWF0Rm5cIl0+WzBdKVxuXHR7XG5cdFx0aWYgKHRoaXNbU1lNX0RBVEFdLmxhYmVsRm9ybWF0Rm4pXG5cdFx0e1xuXHRcdFx0cmV0dXJuIHRoaXNbU1lNX0RBVEFdLmxhYmVsRm9ybWF0Rm4oZGF0YSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGBbJHtkYXRhLm5hbWUudG9TdHJpbmcoKS50b1VwcGVyQ2FzZSgpfV1gXG5cdH1cblxuXHRwcm90ZWN0ZWQgX2xvZyhuYW1lOiBzdHJpbmcsIGFyZ3YsIGZhaWxCYWNrID0gJ2xvZycpXG5cdHtcblx0XHRpZiAoIXRoaXMuZW5hYmxlZClcblx0XHR7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdGxldCBzID0gdGhpcy5fbG9nRm9ybWF0KC4uLmFyZ3YpO1xuXHRcdGxldCBvID0gdGhpc1tTWU1fQ0hBTEtdKHMpO1xuXG5cdFx0bGV0IGFyciA9IFtdO1xuXG5cdFx0bGV0IGRhdGEgPSB0aGlzW1NZTV9EQVRBXTtcblxuXHRcdGlmIChkYXRhLnRpbWUpXG5cdFx0e1xuXHRcdFx0bGV0IHJldCA9IHRoaXMuX3RpbWUoe1xuXHRcdFx0XHRuYW1lLFxuXHRcdFx0XHRhcmd2LFxuXHRcdFx0XHRmYWlsQmFjayxcblx0XHRcdH0pO1xuXG5cdFx0XHRpZiAocmV0ICE9IG51bGwpXG5cdFx0XHR7XG5cdFx0XHRcdGFyci5wdXNoKHJldCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKGRhdGEubGFiZWwpXG5cdFx0e1xuXHRcdFx0bGV0IF9vayA9IHRydWU7XG5cblx0XHRcdGlmIChBcnJheS5pc0FycmF5KGRhdGEubGFiZWwpICYmICFkYXRhLmxhYmVsLmluY2x1ZGVzKG5hbWUpKVxuXHRcdFx0e1xuXHRcdFx0XHRfb2sgPSBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKF9vaylcblx0XHRcdHtcblx0XHRcdFx0bGV0IHJldCA9IHRoaXMuX2xhYmVsRm9ybWF0KHtcblx0XHRcdFx0XHRuYW1lLFxuXHRcdFx0XHRcdGFyZ3YsXG5cdFx0XHRcdFx0ZmFpbEJhY2ssXG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlmIChyZXQgIT0gbnVsbClcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGFyci5wdXNoKHJldCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRhcnIucHVzaChvKTtcblxuXHRcdGlmIChhcnIubGVuZ3RoICYmIGRhdGEuY29sb3JzICYmIGRhdGEuY29sb3JzW25hbWVdKVxuXHRcdHtcblx0XHRcdGxldCBjOiBhbnkgPSBkYXRhLmNvbG9yc1tuYW1lXTtcblxuXHRcdFx0aWYgKHR5cGVvZiBjID09PSAnc3RyaW5nJylcblx0XHRcdHtcblx0XHRcdFx0YyA9IGNoYWxrW2NdO1xuXHRcdFx0fVxuXG5cdFx0XHRhcnIgPSBhcnIubWFwKHYgPT4gYyh2KSk7XG5cdFx0fVxuXG5cdFx0aWYgKHByb2Nlc3MucGxhdGZvcm0gPT0gJ3dpbjMyJyAmJiB0aGlzLmVuYWJsZWRDb2xvcilcblx0XHR7XG5cdFx0XHQvKipcblx0XHRcdCAqIEBGSVhNRSBmaXggYnVnIG9uIHdpbmRvd3Mgd2hlbiBhZnRlciBib2xkXG5cdFx0XHQgKlxuXHRcdFx0ICogaHR0cHM6Ly9naXRodWIuY29tL2NoYWxrL2NoYWxrL2lzc3Vlcy8xNDUjaXNzdWVjb21tZW50LTI4ODk4NTkwM1xuXHRcdFx0ICovXG5cdFx0XHRhcnIgPSBhcnIubWFwKHYgPT4gJ1xcdTAwMUJbMG0nICsgdiArICdcXHUwMDFCWzBtJyk7XG5cdFx0fVxuXG5cdFx0aWYgKCEobmFtZSBpbiB0aGlzW1NZTV9DT05TT0xFXSkpXG5cdFx0e1xuXHRcdFx0bmFtZSA9IGZhaWxCYWNrO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzW1NZTV9DT05TT0xFXVtuYW1lXSguLi5hcnIpO1xuXHR9XG5cblx0cHJvdGVjdGVkIF9jaGFsa1N0eWxlTWV0aG9kKG5hbWUpXG5cdHtcblx0XHRyZXR1cm4gZnVuY3Rpb24gY2hhbGtTdHlsZU1ldGhvZCh0aGlzOiBDb25zb2xlMiwgLi4uYXJndilcblx0XHR7XG5cdFx0XHRsZXQgbyA9IHRoaXMuX2Nsb25lKCk7XG5cblx0XHRcdG9bU1lNX0NIQUxLXSA9IHRoaXNbU1lNX0NIQUxLXVtuYW1lXSguLi5hcmd2KTtcblxuXHRcdFx0cmV0dXJuIG87XG5cdFx0fTtcblx0fVxuXG5cdHByb3RlY3RlZCBfdGltZShkYXRhPzogUGFyYW1ldGVyczxJT3B0aW9uc1tcImxhYmVsRm9ybWF0Rm5cIl0+WzBdKVxuXHR7XG5cdFx0aWYgKHRoaXNbU1lNX0RBVEFdLnRpbWVGb3JtYXRGbilcblx0XHR7XG5cdFx0XHRsZXQgZGF0YTI6IFBhcmFtZXRlcnM8SU9wdGlvbnNbXCJ0aW1lRm9ybWF0Rm5cIl0+WzBdID0ge1xuXHRcdFx0XHQuLi5kYXRhLFxuXHRcdFx0XHRmYWlsQmFja1RpbWVGb3JtYXQ6IHRoaXNbU1lNX0RBVEFdLnRpbWVGb3JtYXQgfHwgJ1tISDptbTpzcy5TU1NdJyxcblx0XHRcdFx0ZGF0ZTogRGF0ZVRpbWUubG9jYWwoKSxcblx0XHRcdH07XG5cblx0XHRcdHJldHVybiB0aGlzW1NZTV9EQVRBXS50aW1lRm9ybWF0Rm4oZGF0YTIpO1xuXHRcdH1cblxuXHRcdHJldHVybiBEYXRlVGltZS5sb2NhbCgpLnRvRm9ybWF0KHRoaXNbU1lNX0RBVEFdLnRpbWVGb3JtYXQgfHwgJ1tISDptbTpzcy5TU1NdJyk7XG5cdH1cbn1cblxudXRpbEluaGVyaXRzKENvbnNvbGUyLCBGdW5jdGlvbik7XG5cbi8vIEB0cy1pZ25vcmVcbkNvbnNvbGUyLnByb3RvdHlwZS5Db25zb2xlID0gQ29uc29sZTJcblxuc3R5bGVOYW1lcy5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKVxue1xuXHRpZiAoc3R5bGVOYW1lc0ZuLmluY2x1ZGVzKG5hbWUgYXMgYW55KSlcblx0e1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zb2xlMi5wcm90b3R5cGUsIG5hbWUsIHtcblx0XHRcdGdldCgpXG5cdFx0XHR7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9jaGFsa1N0eWxlTWV0aG9kKG5hbWUpO1xuXHRcdFx0fSxcblx0XHR9KTtcblx0fVxuXHRlbHNlXG5cdHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc29sZTIucHJvdG90eXBlLCBuYW1lLCB7XG5cdFx0XHRnZXQoKVxuXHRcdFx0e1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5fY2hhbGtTdHlsZVByb3AobmFtZSk7XG5cdFx0XHR9LFxuXHRcdH0pO1xuXHR9XG59KTtcblxubWV0aG9kcy5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKVxue1xuXHRpZiAobmFtZSA9PSAnZGlyJylcblx0e1xuXHRcdENvbnNvbGUyLnByb3RvdHlwZVtuYW1lXSA9IGZ1bmN0aW9uIGNoYWxrU3R5bGVMb2dPdGhlcnMob2JqZWN0LCBvcHRpb25zKVxuXHRcdHtcblx0XHRcdGlmICghdGhpcy5lbmFibGVkKVxuXHRcdFx0e1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGxldCBlbmFibGVkQ29sb3IgPSB0aGlzLmVuYWJsZWRDb2xvcjtcblxuXHRcdFx0aWYgKCFvcHRpb25zICYmIHRoaXNbU1lNX0RBVEFdLmluc3BlY3RPcHRpb25zKVxuXHRcdFx0e1xuXHRcdFx0XHRvcHRpb25zID0gdGhpc1tTWU1fREFUQV0uaW5zcGVjdE9wdGlvbnM7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChvcHRpb25zKVxuXHRcdFx0e1xuXHRcdFx0XHRpZiAoZW5hYmxlZENvbG9yICYmIG9wdGlvbnMuY29sb3JzID09IG51bGwpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRvcHRpb25zID0ge1xuXHRcdFx0XHRcdFx0Li4ub3B0aW9ucyxcblx0XHRcdFx0XHRcdGNvbG9yczogZW5hYmxlZENvbG9yXG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB0aGlzW1NZTV9DT05TT0xFXVtuYW1lXShvYmplY3QsIG9wdGlvbnMpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpc1tTWU1fQ09OU09MRV1bbmFtZV0ob2JqZWN0LCB7XG5cdFx0XHRcdGNvbG9yczogZW5hYmxlZENvbG9yLFxuXHRcdFx0fSk7XG5cdFx0fTtcblx0fVxuXHRlbHNlIGlmIChuYW1lID09ICdhc3NlcnQnKVxuXHR7XG5cdFx0Q29uc29sZTIucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24gY2hhbGtTdHlsZUxvZ0Fzc2VydCh2YWx1ZSwgLi4uYXJndilcblx0XHR7XG5cdFx0XHRpZiAoIXRoaXMuZW5hYmxlZClcblx0XHRcdHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIXZhbHVlKVxuXHRcdFx0e1xuXHRcdFx0XHRsZXQgbztcblx0XHRcdFx0aWYgKGFyZ3YubGVuZ3RoKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdFx0XHRcdGxldCBzID0gdGhpcy5fbG9nRm9ybWF0KC4uLmFyZ3YpO1xuXG5cdFx0XHRcdFx0byA9IHRoaXNbU1lNX0NIQUxLXShzKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gdGhpc1tTWU1fQ09OU09MRV1bbmFtZV0odmFsdWUsIG8pO1xuXHRcdFx0fVxuXHRcdH07XG5cdH1cblx0ZWxzZSBpZiAobWV0aG9kc19zdGRvdXQuaW5jbHVkZXMobmFtZSBhcyBhbnkpKVxuXHR7XG5cdFx0Q29uc29sZTIucHJvdG90eXBlW25hbWUgYXMgYW55XSA9IGZ1bmN0aW9uIGNoYWxrU3R5bGVMb2dTdGRvdXQoLi4uYXJndilcblx0XHR7XG5cdFx0XHQvLyBAdHMtaWdub3JlXG5cdFx0XHRyZXR1cm4gdGhpcy5fbG9nKG5hbWUsIGFyZ3YpXG5cdFx0fTtcblx0fVxuXHRlbHNlIGlmIChtZXRob2RzX3N0ZGVyci5pbmNsdWRlcyhuYW1lIGFzIGFueSkpXG5cdHtcblx0XHRDb25zb2xlMi5wcm90b3R5cGVbbmFtZSBhcyBhbnldID0gZnVuY3Rpb24gY2hhbGtTdHlsZUxvZ1N0ZGVyciguLi5hcmd2KVxuXHRcdHtcblx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdHJldHVybiB0aGlzLl9sb2cobmFtZSwgYXJndiwgJ2Vycm9yJylcblx0XHR9O1xuXHR9XG5cdGVsc2Vcblx0e1xuXHRcdENvbnNvbGUyLnByb3RvdHlwZVtuYW1lIGFzIGFueV0gPSBmdW5jdGlvbiBjaGFsa1N0eWxlTG9nT3RoZXJzKC4uLmFyZ3YpXG5cdFx0e1xuXHRcdFx0aWYgKCF0aGlzLmVuYWJsZWQpXG5cdFx0XHR7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHRoaXNbU1lNX0NPTlNPTEVdW25hbWUgYXMgYW55XSguLi5hcmd2KTtcblx0XHR9O1xuXHR9XG59KTtcblxuZXhwb3J0IGRlZmF1bHQgQ29uc29sZTJcbiJdfQ==